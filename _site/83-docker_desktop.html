<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="es" xml:lang="es"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.550">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Programación SIG: Python, R y Julia - Apéndice D — Docker: Gestión de Contenedores e Imágenes</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./84-git_github.html" rel="next">
<link href="./82-quarto.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Sin resultados",
    "search-matching-documents-text": "documentos encontrados",
    "search-copy-link-title": "Copiar el enlace en la búsqueda",
    "search-hide-matches-text": "Ocultar resultados adicionales",
    "search-more-match-text": "resultado adicional en este documento",
    "search-more-matches-text": "resultados adicionales en este documento",
    "search-clear-button-title": "Borrar",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancelar",
    "search-submit-button-title": "Enviar",
    "search-label": "Buscar"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./80-instalacion_herramientas.html">Apéndices</a></li><li class="breadcrumb-item"><a href="./83-docker_desktop.html"><span class="chapter-number">D</span>&nbsp; <span class="chapter-title">Docker: Gestión de Contenedores e Imágenes</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Programación SIG: Python, R y Julia</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Buscar"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bienvenida</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00-prefacio.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Prefacio</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Instalación y Entornos</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Alternar sección">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-introduccion-entornos.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introducción a Entornos de Desarrollo SIG</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-guia_instalacion_A_docker.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Guía de Instalación. Opción A: Docker (Python, R, Julia)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-guia_instalacion_B_qgis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Guía de Instalación. Opción B: QGIS y PyQGIS</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-guia_instalacion_C_ArcGIS.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Guía de Instalación. Opción C: ArcGIS Pro y ArcPy</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Fundamentos</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Alternar sección">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-variables_tipos_de_datos.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Variables y tipos de datos</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-estructuras_datos.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Estructuras de datos</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-operaciones_cadenas.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Operaciones con Cadenas de Texto (Strings)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-ciclos_condicionales.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Bucles y Declaraciones Condicionales</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-funciones_clases.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Funciones y Clases: El camino a la Modularización</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-introduccion_python_r_julia.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Introducción a Python, R y Julia</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-estructuras_datos_geo.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Estructuras de Datos Geoespaciales</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Prácticas</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Alternar sección">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./41-practica_1_benchmark_raster.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Evaluación Comparativa de Procesamiento Geoespacial</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Presentaciones</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Alternar sección">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./61-presentacion_1_clase1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Temas por Charlar</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./62-presentacion_2_benchmark.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Benchmark geoespacial: cómo leer los resultados</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Apéndices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Alternar sección">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./80-instalacion_herramientas.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Resumen instalación de herramientas</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./81-uso_infraestructura_instalada.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Uso de la Infraestructura Instalada</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./82-quarto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Quarto: Orquestación y Configuración</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./83-docker_desktop.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">D</span>&nbsp; <span class="chapter-title">Docker: Gestión de Contenedores e Imágenes</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./84-git_github.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">E</span>&nbsp; <span class="chapter-title">Git y GitHub: Sincronización Local-Remota</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./85-vscode.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">F</span>&nbsp; <span class="chapter-title">Visual Studio Code (VScode): Extensiones e Interfaz</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./86-windows.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">G</span>&nbsp; <span class="chapter-title">Temas técnicos sobre Windows</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./87-linux_ubuntu.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">H</span>&nbsp; <span class="chapter-title">Temas Técnicos sobre Linux</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./88-python.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">I</span>&nbsp; <span class="chapter-title">Adicionales Sobre Python</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./89-r.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">J</span>&nbsp; <span class="chapter-title">Adicionales Sobre R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./90-julia.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">K</span>&nbsp; <span class="chapter-title">Adicionales Sobre Julia</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./91-qgis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">L</span>&nbsp; <span class="chapter-title">Adicionales Sobre QGIS</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./92-arcgispro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">M</span>&nbsp; <span class="chapter-title">Adicionales sobre ArcGIS Pro</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./93-postgresql.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">N</span>&nbsp; <span class="chapter-title">Adicionales sobre ArcGIS Pro</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./98-errata.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">O</span>&nbsp; <span class="chapter-title">Errata</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./99-referencias.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Referencias Bibliográficas</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Tabla de Contenidos</h2>
   
  <ul>
  <li><a href="#instalación-del-software" id="toc-instalación-del-software" class="nav-link active" data-scroll-target="#instalación-del-software"><span class="header-section-number">D.1</span> Instalación del software</a></li>
  <li><a href="#sec-preparacion_docker" id="toc-sec-preparacion_docker" class="nav-link" data-scroll-target="#sec-preparacion_docker"><span class="header-section-number">D.2</span> Preparación Docker Desktop</a></li>
  <li><a href="#sec-limpieza_entorno" id="toc-sec-limpieza_entorno" class="nav-link" data-scroll-target="#sec-limpieza_entorno"><span class="header-section-number">D.3</span> Limpieza del entorno</a>
  <ul class="collapse">
  <li><a href="#eliminar-todas-las-imagenescontenedores-y-liberar-todo-el-espacio-usado-por-docker." id="toc-eliminar-todas-las-imagenescontenedores-y-liberar-todo-el-espacio-usado-por-docker." class="nav-link" data-scroll-target="#eliminar-todas-las-imagenescontenedores-y-liberar-todo-el-espacio-usado-por-docker.">Eliminar todas las imagenes/contenedores y liberar todo el espacio usado por Docker.</a></li>
  <li><a href="#comandos-de-rescate-de-espacio" id="toc-comandos-de-rescate-de-espacio" class="nav-link" data-scroll-target="#comandos-de-rescate-de-espacio">Comandos de rescate de espacio</a></li>
  </ul></li>
  <li><a href="#sec-descarga_tar_yml" id="toc-sec-descarga_tar_yml" class="nav-link" data-scroll-target="#sec-descarga_tar_yml"><span class="header-section-number">D.4</span> Descarga y preparación de archivos</a></li>
  <li><a href="#sec-cargar_docker_tar" id="toc-sec-cargar_docker_tar" class="nav-link" data-scroll-target="#sec-cargar_docker_tar"><span class="header-section-number">D.5</span> Cargar imagen/contenedor a partir de imagen/contenedor base guardada en <code>sig_unal_completo.tar</code> y <code>docker-compose.html</code></a>
  <ul class="collapse">
  <li><a href="#sec-docker_compose_load" id="toc-sec-docker_compose_load" class="nav-link" data-scroll-target="#sec-docker_compose_load">Archivo <code>docker-compose.yml</code> (orquestación)</a></li>
  </ul></li>
  <li><a href="#sec-build_docker" id="toc-sec-build_docker" class="nav-link" data-scroll-target="#sec-build_docker"><span class="header-section-number">D.6</span> Compilar imagen/contenedor a partir de <code>Dockerfile</code> y <code>docker-compose.html</code></a>
  <ul class="collapse">
  <li><a href="#sec-docker_compose_compile" id="toc-sec-docker_compose_compile" class="nav-link" data-scroll-target="#sec-docker_compose_compile">Archivo <code>docker-compose.yml</code></a></li>
  <li><a href="#archivo-dockerfile-construcción-del-entorno" id="toc-archivo-dockerfile-construcción-del-entorno" class="nav-link" data-scroll-target="#archivo-dockerfile-construcción-del-entorno">Archivo <code>Dockerfile</code> (Construcción del Entorno)</a></li>
  </ul></li>
  <li><a href="#sec-arrancar_detener_contenedores" id="toc-sec-arrancar_detener_contenedores" class="nav-link" data-scroll-target="#sec-arrancar_detener_contenedores"><span class="header-section-number">D.7</span> Arrancar y detener las imágenes</a>
  <ul class="collapse">
  <li><a href="#arrancar-las-imágenes" id="toc-arrancar-las-imágenes" class="nav-link" data-scroll-target="#arrancar-las-imágenes">Arrancar las imágenes</a></li>
  <li><a href="#detener-las-imágenes" id="toc-detener-las-imágenes" class="nav-link" data-scroll-target="#detener-las-imágenes">Detener las imágenes</a></li>
  </ul></li>
  <li><a href="#verificar-logs-de-instalación" id="toc-verificar-logs-de-instalación" class="nav-link" data-scroll-target="#verificar-logs-de-instalación"><span class="header-section-number">D.8</span> Verificar logs de instalación</a></li>
  <li><a href="#comandos-docker" id="toc-comandos-docker" class="nav-link" data-scroll-target="#comandos-docker"><span class="header-section-number">D.9</span> Comandos docker</a></li>
  <li><a href="#compilación-avanzada" id="toc-compilación-avanzada" class="nav-link" data-scroll-target="#compilación-avanzada"><span class="header-section-number">D.10</span> Compilación avanzada</a></li>
  <li><a href="#cambio-de-ruta-de-almacenamiento-windows" id="toc-cambio-de-ruta-de-almacenamiento-windows" class="nav-link" data-scroll-target="#cambio-de-ruta-de-almacenamiento-windows"><span class="header-section-number">D.11</span> Cambio de ruta de almacenamiento (Windows)</a></li>
  <li><a href="#sec-optimizacion-memoria" id="toc-sec-optimizacion-memoria" class="nav-link" data-scroll-target="#sec-optimizacion-memoria"><span class="header-section-number">D.12</span> Optimización de memoria RAM y swap</a>
  <ul class="collapse">
  <li><a href="#el-pulmón-de-windows-memoria-virtual" id="toc-el-pulmón-de-windows-memoria-virtual" class="nav-link" data-scroll-target="#el-pulmón-de-windows-memoria-virtual">1. El “pulmón” de Windows: memoria virtual</a></li>
  <li><a href="#el-túnel-de-docker-swap-de-wsl2" id="toc-el-túnel-de-docker-swap-de-wsl2" class="nav-link" data-scroll-target="#el-túnel-de-docker-swap-de-wsl2">2. El “túnel” de docker: swap de WSL2</a></li>
  </ul></li>
  <li><a href="#higiene-y-limpieza-de-choque" id="toc-higiene-y-limpieza-de-choque" class="nav-link" data-scroll-target="#higiene-y-limpieza-de-choque"><span class="header-section-number">D.13</span> Higiene y limpieza de choque</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./80-instalacion_herramientas.html">Apéndices</a></li><li class="breadcrumb-item"><a href="./83-docker_desktop.html"><span class="chapter-number">D</span>&nbsp; <span class="chapter-title">Docker: Gestión de Contenedores e Imágenes</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span id="sec-anexo_docker" class="quarto-section-identifier">Apéndice D — Docker: Gestión de Contenedores e Imágenes</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Docker es un motor de virtualización <span class="citation" data-cites="docker2025">(<a href="99-referencias.html#ref-docker2025" role="doc-biblioref">Inc., 2025</a>)</span> en el que instalaremos las dos máquinas virtuales Linux que permitirán la ejecución de código Python, R y Julia y el acceso a PostGIS + PostgreSQL.</p>
<section id="instalación-del-software" class="level2" data-number="D.1">
<h2 data-number="D.1" class="anchored" data-anchor-id="instalación-del-software"><span class="header-section-number">D.1</span> Instalación del software</h2>
<p>Descargue e instale la versión oficial de <strong>Docker Desktop</strong> desde el siguiente enlace:</p>
<ul>
<li><strong>URL</strong>: <a href="https://www.docker.com/products/docker-desktop/" class="uri">https://www.docker.com/products/docker-desktop/</a></li>
<li>Descargue la versión más reciente para el sistema operativo de su máquina local y verifique que el instalador coincida con la arquitectura de su máquina.</li>
<li><strong>Instalación</strong>: Para instalar en una carpeta específica (ej: <code>E:\Docker</code>) seleccionada por el usuario. Ejecute en PowerShell como administrador. Asegúrese de aceptar la actualización del kernel de WSL 2 si el sistema lo solicita, o previamente usar en el terminal <code>wsl --update</code>. Durante la instalación, asegúrese de activar la opción <strong>“Use WSL 2 instead of Hyper-V”</strong>.</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">Start-Process</span> <span class="st">"Docker Desktop Installer.exe"</span> <span class="at">-ArgumentList</span> <span class="st">"install"</span>, <span class="st">"--installation-dir=E:\Docker"</span> <span class="at">-Wait</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><strong>Instalación alternativa</strong>: Ejecute el instalador y asegúrese de aceptar la actualización del kernel de WSL 2 si el sistema lo solicita, o previamente usar en el terminal <code>wsl --update</code>. Durante la instalación, asegúrese de activar la opción <strong>“Use WSL 2 instead of Hyper-V”</strong>.</li>
</ul>
</section>
<section id="sec-preparacion_docker" class="level2" data-number="D.2">
<h2 data-number="D.2" class="anchored" data-anchor-id="sec-preparacion_docker"><span class="header-section-number">D.2</span> Preparación Docker Desktop</h2>
<p>Antes de iniciar la carga o instalación de imágenes/contenedores, es imperativo configurar el entorno local:</p>
<ul>
<li><p><strong>Configuración de Almacenamiento</strong>: Debido a que la imagen políglota y la base de datos requieren un espacio considerable, asegúrese de que el disco donde Docker guarda sus archivos <code>.vhdx</code> tenga al menos <strong>50 GB de espacio libre</strong>. Tenga en cuenta que el tamaño en disco de las dos imágenes Docker, una vez instaladas, es de aproximadamente <strong>45 GB</strong>.</p></li>
<li><p><strong>Procedimiento para cambiar la ubicación de las imágenes</strong> (archivos con extensión <code>.vhdx</code>): Si su disco principal (<code>C:</code>) está sin espacio, mueva los archivos Docker a otro disco. En Docker Desktop:</p>
<ol type="a">
<li>Diríjase a <strong>Settings</strong> (engranaje) -&gt; <strong>Resources</strong> -&gt; <strong>Advanced</strong>.</li>
<li>Localice <strong>Disk image location</strong>.</li>
<li>Haga clic en <code>Browse</code> y seleccione una carpeta en un disco con mayor capacidad.</li>
<li>Haga clic en <strong>Apply &amp; restart</strong>.</li>
</ol></li>
<li><p><strong>Optimización de Memoria Swap</strong>: Para procesar datos raster de gran tamaño sin interrupciones en R o Julia, es fundamental ampliar la memoria Swap (espacio de intercambio). Puede consultar más detalles en la <a href="#sec-limpieza_entorno" class="quarto-xref"><span>Sección D.3</span></a> sobre cómo esto impacta el rendimiento.</p></li>
<li><p><strong>Procedimiento para aumentar Swap en Windows (Host)</strong>: Ajuste la memoria virtual del sistema operativo para evitar cierres por falta de RAM:</p>
<ol type="a">
<li>En el buscador de Windows, escriba y seleccione <strong>“Ver la configuración avanzada del sistema”</strong>.</li>
<li>En la pestaña <strong>Opciones avanzadas</strong>, sección <strong>Rendimiento</strong>, haga clic en el botón <code>Configuración</code>.</li>
<li>Diríjase a <strong>Opciones avanzadas</strong> -&gt; <strong>Memoria Virtual</strong> y haga clic en <code>Cambiar</code>.</li>
<li>Desmarque “Administrar automáticamente”, seleccione el disco principal, elija <strong>Tamaño personalizado</strong> y asigne estos valores sugeridos, que dependen del espacio disponible en el disco (verifíquelo): Inicial <strong>16384 MB</strong> / Máximo <strong>32768 MB</strong>.</li>
<li>Haga clic en <code>Establecer</code> y luego en <strong>Aceptar</strong> (requerirá reiniciar el equipo).</li>
</ol></li>
<li><p><strong>Configuración de Swap en el Contenedor (WSL2)</strong>: Dado que Docker opera sobre el subsistema Linux, debe configurar el archivo de intercambio global de WSL2:</p>
<ol type="a">
<li>Abra el explorador de archivos y diríjase a su carpeta de usuario (escriba <code>%USERPROFILE%</code> en la barra de direcciones).</li>
<li>Cree un archivo nuevo llamado <code>.wslconfig</code> (asegúrese de que no tenga extensión <code>.txt</code> al final).</li>
<li>Defina la RAM (<code>memory</code>) y asegure suficiente memoria <code>swap</code> (ej: <strong>32 GB de swap</strong>) para sus procesos espaciales (sugerido, depende de su espacio en disco).</li>
<li>Cambie la ruta del archivo <code>swap.vhdx</code> a un disco veloz y con suficiente espacio de disco.</li>
</ol></li>
</ul>
<div class="sourceCode" id="cb2"><pre class="sourceCode ini code-with-copy"><code class="sourceCode ini"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">[wsl2]</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="dt">memory</span><span class="ot">=</span><span class="st">12GB # RAM máxima física asignada a Linux</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="dt">swap</span><span class="ot">=</span><span class="st">32GB   # Memoria de intercambio para evitar el cierre de contenedores</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="dt">swapfile</span><span class="ot">=</span><span class="st">X:\RutaConSuficienteEspacioEnDisco\\swap.vhdx</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Importante
</div>
</div>
<div class="callout-body-container callout-body">
<p>Si desea verificar si estos cambios surtieron efecto dentro de su laboratorio, puede ejecutar el comando <code>free -h</code> en la terminal de Jupyter o VSCode.</p>
</div>
</div>
</section>
<section id="sec-limpieza_entorno" class="level2" data-number="D.3">
<h2 data-number="D.3" class="anchored" data-anchor-id="sec-limpieza_entorno"><span class="header-section-number">D.3</span> Limpieza del entorno</h2>
<section id="eliminar-todas-las-imagenescontenedores-y-liberar-todo-el-espacio-usado-por-docker." class="level3">
<h3 class="anchored" data-anchor-id="eliminar-todas-las-imagenescontenedores-y-liberar-todo-el-espacio-usado-por-docker.">Eliminar todas las imagenes/contenedores y liberar todo el espacio usado por Docker.</h3>
<blockquote class="blockquote">
<p><strong>⚠️ Advertencia</strong>: Los siguientes comandos eliminarán todos los contenedores, imágenes y volúmenes existentes en su sistema. Úselos solo si no tiene contenedores o imágenes que desee preservar.</p>
</blockquote>
<p>Ejecute estos comandos en su terminal (PowerShell) para liberar espacio y evitar conflictos:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Detener y eliminar todos los contenedores</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> stop <span class="va">$(</span><span class="ex">docker</span> ps <span class="at">-aq</span><span class="va">)</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> rm <span class="at">-f</span> <span class="va">$(</span><span class="ex">docker</span> ps <span class="at">-aq</span><span class="va">)</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Eliminar todas las imágenes</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> rmi <span class="at">-f</span> <span class="va">$(</span><span class="ex">docker</span> images <span class="at">-aq</span><span class="va">)</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Eliminar todos los volúmenes (libera MUCHO espacio)</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> volume rm <span class="va">$(</span><span class="ex">docker</span> volume ls <span class="at">-q</span><span class="va">)</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Eliminar redes de usuario (no borra bridge/host/none)</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> network rm <span class="va">$(</span><span class="ex">docker</span> network ls <span class="at">-q</span> <span class="kw">|</span> <span class="ex">Select-String</span> <span class="at">-NotMatch</span> <span class="st">"bridge|host|none"</span><span class="va">)</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Eliminar caché de construcción</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> builder prune <span class="at">-a</span> <span class="at">-f</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="co"># OPCIÓN MÁS SIMPLE (Todo en un solo comando)</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="co"># docker system prune -a --volumes -f</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Para verificar el espacio liberado, use: <code>docker system df</code>. El resultado debería mostrar valores cercanos a <strong>0 bytes</strong>.</p>
</section>
<section id="comandos-de-rescate-de-espacio" class="level3">
<h3 class="anchored" data-anchor-id="comandos-de-rescate-de-espacio">Comandos de rescate de espacio</h3>
<p>El entorno políglota de este curso es robusto y, por lo tanto, pesado. Tras realizar actualizaciones o varias pruebas de construcción, es posible que el espacio en disco se agote rápidamente.</p>
<p>Si recibe errores de “Disk Full” o desea limpiar su sistema, ejecute los siguientes comandos en su terminal de Windows (PowerShell):</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode powershell code-with-copy"><code class="sourceCode powershell"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Eliminar contenedores detenidos y redes en desuso</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>docker system prune <span class="op">-</span>f</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Limpiar caché de construcción (libera mucho espacio tras errores de build)</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>docker builder prune <span class="op">-</span>f</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. (Uso extremo) Eliminar TODAS las imágenes que no estén siendo usadas</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co"># docker image prune -a -f</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Seguridad de sus Datos
</div>
</div>
<div class="callout-body-container callout-body">
<p>No tema realizar limpiezas periódicas. Gracias a la configuración de volúmenes en nuestro archivo <code>docker-compose.yml</code>, todo su código, scripts y datos espaciales están <strong>físicamente en su disco local</strong> (en la carpeta de su ID UNAL).</p>
<p>Al apagar o borrar el contenedor, lo que está dentro de <code>/home/rstudio/work/</code> <strong>siempre estará a salvo</strong> en su carpeta de Windows. El contenedor es solo el “motor”, sus archivos son el “combustible” que usted posee.</p>
</div>
</div>
</section>
</section>
<section id="sec-descarga_tar_yml" class="level2" data-number="D.4">
<h2 data-number="D.4" class="anchored" data-anchor-id="sec-descarga_tar_yml"><span class="header-section-number">D.4</span> Descarga y preparación de archivos</h2>
<p>Siga estos pasos para obtener la imagen base:</p>
<ol type="1">
<li><strong>Descarga</strong>: Obtenga el archivo de 15.5 GB desde el siguiente enlace: <a href="https://drive.google.com/file/d/1J7ssf72-F5EwjoekkexwKUgD1DxyA1xk/view?usp=sharing">Google Drive - sig_unal_completo.zip</a>.</li>
<li><strong>Descompresión Parte A</strong>: Extraiga el contenido de <code>sig_unal_completo.zip</code>.</li>
<li><strong>Renombrado</strong>: Al archivo resultante llamado <code>sig_unal_completo.txt</code>, cámbiele manualmente la extensión a <code>.zip</code>.</li>
<li><strong>Descompresión Parte B</strong>: Extraiga este nuevo archivo <code>.zip</code> para obtener los dos archivos definitivos:
<ul>
<li><code>sig_unal_completo.tar</code> (El archivo de la imagen).</li>
<li><code>docker-compose.yml</code> (El <strong>NUEVO</strong> archivo de orquestación contenido en la descarga).</li>
</ul></li>
</ol>
</section>
<section id="sec-cargar_docker_tar" class="level2" data-number="D.5">
<h2 data-number="D.5" class="anchored" data-anchor-id="sec-cargar_docker_tar"><span class="header-section-number">D.5</span> Cargar imagen/contenedor a partir de imagen/contenedor base guardada en <code>sig_unal_completo.tar</code> y <code>docker-compose.html</code></h2>
<p>Este procedimiento instalará (mediante carga, es decir sin compilación) dos imágenes (una con la base de datos espacial y otra con Python, R y Julia) y configurará una red interna para comunicar su máquina anfitriona (Windows) con las dos máquinas virtuales Linux.</p>
<p>Desde una terminal situada en la carpeta que contiene los archivos <code>sig_unal_completo.tar</code> y <code>docker-compose.yml</code>, ejecute:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> load <span class="at">-i</span> sig_unal_completo.tar</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><em>Este proceso puede tardar varios minutos o inclusive horas dependiendo de su procesador y disco duro. Verifique que al finalizar aparezca el mensaje “Loaded image” para <code>image_sig_unal:final</code> y <code>postgis_unal:final</code>.</em></p>
<blockquote class="blockquote">
<p>Nota: Existen dos versiones <strong>diferentes</strong> del archivo <code>docker-compose.html</code>. El primero es el que se describe en <a href="#sec-build_docker" class="quarto-xref"><span>Sección D.6</span></a> y el segundo, que aplica para este procedimiento, es el que se descarga en <a href="#sec-descarga_tar_yml" class="quarto-xref"><span>Sección D.4</span></a>.</p>
</blockquote>
<section id="sec-docker_compose_load" class="level3">
<h3 class="anchored" data-anchor-id="sec-docker_compose_load">Archivo <code>docker-compose.yml</code> (orquestación)</h3>
<p>Este archivo es el <strong>manifiesto técnico</strong> que automatiza la construcción y coordinación de los servicios del curso. Su propósito es definir las reglas de convivencia entre los contenedores, configurando los siguientes pilares:</p>
<ul>
<li><strong>Imágenes</strong>: Versiones exactas de software (GDAL/Ubuntu para análisis y PostGIS para datos).</li>
<li><strong>Puertos</strong>: Mapeos específicos para acceder a las herramientas desde el equipo local sin conflictos (8889 para Jupyter, 8788 para el visor de R y 5434 para la base de datos).</li>
<li><strong>Volúmenes</strong>: Garantizan la persistencia de datos, sincronizando su carpeta local en tiempo real con el entorno interno del contenedor.</li>
</ul>
<p>A continuación, se describen los dos servicios integrados en este manifiesto:</p>
<ul>
<li><p><strong>Servicio de Análisis (<code>analisis-geo</code>)</strong>: Identificado en el archivo como <code>analisis-geo</code>, este servicio no usa <code>Dockerfile</code> (la etiqueta <code>build: .</code> está no está habilitada). Es el motor políglota encargado de procesar R, Python y Julia sobre una base robusta de GDAL. Incluye una configuración de <code>LD_PRELOAD</code> para la estabilidad de las librerías dinámicas y una integración profunda que permite usar el visor <code>httpgd</code> de R como terminal gráfica unificada para todos los lenguajes. Crea el contenedor <code>contenedor_sig_unal</code>. La carpeta <code>/home/rstudio/work</code> del contenedor, mapea la carpeta del equipo local donde instaló las imágenes y contenedores a partir de <code>sig_unal_completo.tar</code> y <code>docker-compose.yml</code>.</p></li>
<li><p><strong>Servicio PostGIS (<code>db-postgis</code>)</strong>: Identificado como <code>db-postgis</code>, este servicio apunta a una imagen que fue creada a partir de la imagen especializada de Kartoza. Levanta el servidor de base de datos <code>sig_db_unal</code>, configurado para recibir conexiones espaciales desde sus scripts o herramientas externas como QGIS o ArcGIS a través del puerto <code>5434</code>.</p></li>
</ul>
<div class="sourceCode" id="cb6"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">services</span><span class="kw">:</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">analisis-geo</span><span class="kw">:</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co">    # build: .                          # &lt;--- No utiliza Dockerfile</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> image_sig_unal:final</span><span class="co">         # &lt;--- Agrega esto para nombrar la imagen</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">container_name</span><span class="kw">:</span><span class="at"> contenedor_sig_unal</span><span class="co"> # &lt;--- Cambia esto para el contenedor    </span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">tty</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">stdin_open</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> .:/home/rstudio/work</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> RETICULATE_PYTHON=/usr/bin/python3</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> QUARTO_PYTHON=/usr/bin/python3</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> JULIA_HOME=/opt/julia/bin</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="co">      # Mantenemos la "cirugía" de Julia para que no choque con GDAL</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> LD_PRELOAD=/usr/lib/x86_64-linux-gnu/libcurl.so.4:/usr/lib/x86_64-linux-gnu/libstdc++.so.6</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> GKSwstype=100</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="co">      # Forzamos IPv4 para que VS Code no se pierda en el limbo del [::1]</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="co">      # JUPYTER: El 8889 de tu PC va al 8888 del contenedor</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">"127.0.0.1:8889:8888"</span><span class="co"> # &lt;----- Para programar en Notebooks localhost:8889</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a><span class="co">      # R VISOR (httpgd): El 8788 de tu PC va al 8787 del contenedor </span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">"127.0.0.1:8788:8787"</span><span class="co"> # &lt;----- Para ver los gráficos de R (httpgd) localhost:8788</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">depends_on</span><span class="kw">:</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> db-postgis</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">db-postgis</span><span class="kw">:</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> postgis_unal:final</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">container_name</span><span class="kw">:</span><span class="at"> contenedor_postgis_unal    </span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> POSTGRES_USER=profe_unal</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> POSTGRES_PASS=geomatica2025</span></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> POSTGRES_DB=sig_db_unal</span></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a><span class="co">      # Para acceder a la base de datos desde fuera del contenedor se usa 5434</span></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">"127.0.0.1:5434:5432"</span><span class="at"> </span></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> postgis_data_unal:/var/lib/postgresql</span></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">postgis_data_unal</span><span class="kw">:</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="sec-build_docker" class="level2" data-number="D.6">
<h2 data-number="D.6" class="anchored" data-anchor-id="sec-build_docker"><span class="header-section-number">D.6</span> Compilar imagen/contenedor a partir de <code>Dockerfile</code> y <code>docker-compose.html</code></h2>
<p>El procedimiento que garantiza una instalación (carga) exitosa de las imágenes y contenedores fue documentado en <a href="#sec-cargar_docker_tar" class="quarto-xref"><span>Sección D.5</span></a>. Use este procedimiento <strong>solo si</strong> necesita <strong>compilar</strong> una nueva imagen con contenedores que satisfagan necesidades particulares definidas a partir de un archivo <code>Dockerfile</code>. Sin embargo, el <code>Dockerfile</code> que se presenta en esta sección fue el que se utilizó para compilar la imagen empaquetada cuyo proceso de carga se define en <a href="#sec-cargar_docker_tar" class="quarto-xref"><span>Sección D.5</span></a>.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Organización del Proyecto
</div>
</div>
<div class="callout-body-container callout-body">
<p>Para automatizar el despliegue de los dos contenedores del curso (<code>analisis-geo</code> y <code>db-postgis</code>), se utilizó la orquestación de Docker. Mientras que el entorno de análisis se construyó a medida sobre la imagen base <code>ghcr.io/osgeo/gdal:ubuntu-full-latest</code>, el servicio de base de datos utilizó la imagen especializada <code>kartoza/postgis</code>.</p>
<p>Para este proceso, se utilizaron dos archivos clave: <strong>docker-compose.yml</strong> y <strong>Dockerfile</strong>.</p>
</div>
</div>
<table class="table">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Archivo</th>
<th style="text-align: left;">Rol Crítico</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong><code>Dockerfile</code></strong></td>
<td style="text-align: left;"><strong>El “Qué” (La Receta):</strong> Crea el entorno políglota desde cero, instala las librerías de NASA/Copernicus y aplica la <strong>“cirugía” de OpenSSL</strong> para que Julia sea estable en Ubuntu Noble.</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong><code>docker-compose.yml</code></strong></td>
<td style="text-align: left;"><strong>El “Cómo” (La Orquesta):</strong> Despliega los servicios, mapea los puertos externos (<strong>8889</strong>, <strong>8788</strong>, <strong>5434</strong>) y asegura que sus mapas y bases de datos no se borren gracias al volumen persistente (<code>postgis_data_unal</code>).</td>
</tr>
</tbody>
</table>
<ol type="1">
<li><p>Cree una carpeta utilizando su <strong>ID de usuario de correo institucional</strong> como nombre (el identificador que aparece antes del <code>@unal.edu.co</code>). Por ejemplo, si su correo es <code>juperez@unal.edu.co</code>, la carpeta deberá llamarse <code>juperez</code>. En adelante llamaremos a esa carpeta <code>su_carpeta</code> o la carpeta <code>ID UNAL</code>.</p></li>
<li><p>Dentro de ella, guarde los archivos que se presentan a continuación.</p></li>
</ol>
<p>Antes de compilar debes:</p>
<ol type="1">
<li>Arrancar Docker Desktop</li>
<li>Cree una carpeta donde desea compilar las imágenes y copie allí los archivos <code>Dockerfile</code> y <code>docker-compose.html</code>.</li>
<li>Usando la terminal (<strong>PowerShell</strong> en Windows) del equipo local, cambiase a la carpeta usando el comando <code>cd</code>, ej:</li>
</ol>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> <span class="st">"ruta_a_carpeta"</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol start="4" type="1">
<li><strong>Configuración de Terminal</strong>: Abra PowerShell y ejecute el siguiente comando para visualizar correctamente caracteres especiales y logs:</li>
</ol>
<div class="sourceCode" id="cb8"><pre class="sourceCode powershell code-with-copy"><code class="sourceCode powershell"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Forzar UTF8 en el PowerShell</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="op">[</span>Console<span class="op">]::</span>OutputEncoding <span class="op">=</span> <span class="op">[</span>System<span class="op">.</span><span class="fu">Text</span><span class="op">.</span><span class="fu">Encoding</span><span class="op">]::</span>UTF8</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>El siguiente paso es <strong>compilar</strong> (solo una vez):</p>
<ol start="5" type="1">
<li><strong>Compilación limpia (sin usar caché) con archivo log:</strong></li>
</ol>
<p><em>Opción 1: (recomendado)</em> - Guarda el log al archivo y también lo muestra en la terminal - No utiliza archivos previamente descargados (<code>--no-cache</code>)</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> compose build <span class="at">--no-cache</span> <span class="dv">2</span><span class="op">&gt;&amp;</span><span class="dv">1</span> <span class="kw">|</span> <span class="fu">tee</span> build_sig_unal.log</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><em>Opción 2:</em> - Guarda el log al archivo y no deja ver nada en la terminal - No utiliza archivos previamente descargados (<code>--no-cache</code>) - Se le asigna un etiqueta y una versión a la imagen (<strong>mi_sig_env:v1</strong>), lo cual evita referirse a ella por su ID hexadecimal que es imposible de recordar.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> build <span class="at">--no-cache</span> <span class="at">-t</span> mi_sig_env:v1 . <span class="op">&gt;</span> build_details.log <span class="dv">2</span><span class="op">&gt;&amp;</span><span class="dv">1</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="sec-docker_compose_compile" class="level3">
<h3 class="anchored" data-anchor-id="sec-docker_compose_compile">Archivo <code>docker-compose.yml</code></h3>
<div class="sourceCode" id="cb11"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">services</span><span class="kw">:</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co">  # ============================================================</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co">  # SERVICIO PRINCIPAL</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co">  # Entorno de análisis geoespacial y científico</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co">  # Integra R, Python, Julia, GDAL, Quarto y Jupyter</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co">  # ============================================================</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">analisis-geo</span><span class="kw">:</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">build</span><span class="kw">:</span><span class="at"> .</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> image_sig_unal</span><span class="co">                 # Nombre de la imagen Docker que se construye localmente</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">container_name</span><span class="kw">:</span><span class="at"> contenedor_sig_unal</span><span class="co">   # Nombre del contenedor (más fácil de usar en docker exec)</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="at">    </span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="co">    # Permite sesiones interactivas (terminal, REPLs, etc.)</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">tty</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">stdin_open</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="co">    # Carpeta compartida:</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="co">    # Todo lo que esté en el proyecto (host) aparece dentro del contenedor</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> .:/home/rstudio/work</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a><span class="co">    # ------------------------------------------------------------</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a><span class="co">    # VARIABLES DE ENTORNO</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a><span class="co">    # Aseguran que R, Python, Julia y Quarto usen versiones correctas</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a><span class="co">    # ------------------------------------------------------------</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> RETICULATE_PYTHON=/usr/bin/python3</span><span class="co">   # Python que usará R (reticulate)</span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> QUARTO_PYTHON=/usr/bin/python3</span><span class="co">       # Python que usará Quarto</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> JULIA_HOME=/opt/julia/bin</span><span class="co">             # Ruta base de Julia</span></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a><span class="co">      # "Cirugía" necesaria para evitar conflictos entre Julia y GDAL</span></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a><span class="co">      # (muy común en entornos científicos mixtos)</span></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> LD_PRELOAD=/usr/lib/x86_64-linux-gnu/libcurl.so.4:/usr/lib/x86_64-linux-gnu/libstdc++.so.6</span></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a><span class="co">      # Backend gráfico de Julia (evita errores al graficar en contenedores)</span></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> GKSwstype=100</span></span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a><span class="co">    # ------------------------------------------------------------</span></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a><span class="co">    # PUERTOS</span></span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a><span class="co">    # izquierda = computador del estudiante (acceso externo con localhost)</span></span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a><span class="co">    # derecha   = contenedor (acceso interno - EXPOSE)</span></span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a><span class="co">    # ------------------------------------------------------------</span></span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a><span class="co">      # Jupyter Notebook / JupyterLab</span></span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a><span class="co">      # Se accede desde el navegador en: http://localhost:8889</span></span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">"127.0.0.1:8889:8888"</span></span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a><span class="co">      # Visor de gráficos de R (httpgd)</span></span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a><span class="co">      # Permite ver gráficos interactivos fuera de RStudio</span></span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">"127.0.0.1:8788:8787"</span></span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a><span class="co">    # Este servicio solo se inicia cuando la base de datos esté lista</span></span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">depends_on</span><span class="kw">:</span></span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> db-postgis</span></span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true" tabindex="-1"></a><span class="co">  # ============================================================</span></span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true" tabindex="-1"></a><span class="co">  # SERVICIO DE BASE DE DATOS</span></span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true" tabindex="-1"></a><span class="co">  # PostgreSQL + PostGIS para datos espaciales</span></span>
<span id="cb11-58"><a href="#cb11-58" aria-hidden="true" tabindex="-1"></a><span class="co">  # ============================================================</span></span>
<span id="cb11-59"><a href="#cb11-59" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">db-postgis</span><span class="kw">:</span></span>
<span id="cb11-60"><a href="#cb11-60" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> kartoza/postgis:latest</span></span>
<span id="cb11-61"><a href="#cb11-61" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">container_name</span><span class="kw">:</span><span class="at"> contenedor_postgis_unal</span></span>
<span id="cb11-62"><a href="#cb11-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-63"><a href="#cb11-63" aria-hidden="true" tabindex="-1"></a><span class="co">    # Credenciales y base de datos inicial</span></span>
<span id="cb11-64"><a href="#cb11-64" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb11-65"><a href="#cb11-65" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> POSTGRES_USER=profe_unal</span></span>
<span id="cb11-66"><a href="#cb11-66" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> POSTGRES_PASS=geomatica2025</span></span>
<span id="cb11-67"><a href="#cb11-67" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> POSTGRES_DB=sig_db_unal</span></span>
<span id="cb11-68"><a href="#cb11-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-69"><a href="#cb11-69" aria-hidden="true" tabindex="-1"></a><span class="co">    # Puerto para conectarse desde QGIS, DBeaver, PgAdmin, etc.</span></span>
<span id="cb11-70"><a href="#cb11-70" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb11-71"><a href="#cb11-71" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">"127.0.0.1:5434:5432"</span></span>
<span id="cb11-72"><a href="#cb11-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-73"><a href="#cb11-73" aria-hidden="true" tabindex="-1"></a><span class="co">    # Volumen persistente:</span></span>
<span id="cb11-74"><a href="#cb11-74" aria-hidden="true" tabindex="-1"></a><span class="co">    # Los datos NO se pierden aunque el contenedor se borre</span></span>
<span id="cb11-75"><a href="#cb11-75" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb11-76"><a href="#cb11-76" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> postgis_data_unal:/var/lib/postgresql</span></span>
<span id="cb11-77"><a href="#cb11-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-78"><a href="#cb11-78" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb11-79"><a href="#cb11-79" aria-hidden="true" tabindex="-1"></a><span class="co"># VOLUMENES DOCKER</span></span>
<span id="cb11-80"><a href="#cb11-80" aria-hidden="true" tabindex="-1"></a><span class="co"># Espacio en disco administrado por Docker</span></span>
<span id="cb11-81"><a href="#cb11-81" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb11-82"><a href="#cb11-82" aria-hidden="true" tabindex="-1"></a><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb11-83"><a href="#cb11-83" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">postgis_data_unal</span><span class="kw">:</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="archivo-dockerfile-construcción-del-entorno" class="level3">
<h3 class="anchored" data-anchor-id="archivo-dockerfile-construcción-del-entorno">Archivo <code>Dockerfile</code> (Construcción del Entorno)</h3>
<p>Este archivo constituye la <strong>receta de construcción</strong> del entorno de análisis. Su función es “congelar” un sistema operativo Ubuntu Noble optimizado, garantizando que todos los estudiantes trabajen exactamente con las mismas versiones de librerías, compiladores y paquetes. Con este archivo <code>Dockerfile</code> y con el anterior archivo <code>docker-compose.yml</code> (<a href="#sec-docker_compose_compile" class="quarto-xref"><span>Sección D.6.1</span></a>) fue que se <strong>compiló</strong> la imagen que después se empaquetó en el archivo <code>sig_unal_completo.tar</code> para la carga de contenedores sin conexión a Internet. Note que el archivo <code>docker-compose.yml</code> (<a href="#sec-docker_compose_load" class="quarto-xref"><span>Sección D.5.1</span></a>) que acompaña a <code>sig_unal_completo.tar</code> es diferente al archivo <code>docker-compose.yml</code> detallado en esta sección.</p>
<p>Los pilares técnicos del archivo <code>Dockerfile</code> son:</p>
<ul>
<li><strong>Imagen Base Profesional</strong>: Utiliza la distribución oficial de <strong>OSGeo/GDAL</strong>, que provee el stack más estable de librerías geoespaciales (<code>PROJ</code>, <code>GEOS</code>, <code>GDAL</code>) a nivel de sistema.</li>
<li><strong>Pila Políglota Integrada</strong>: Automatiza la instalación y configuración de <strong>R</strong>, <strong>Python 3</strong> y <strong>Julia 1.10.4</strong>, resolviendo dependencias cruzadas que suelen ser difíciles de configurar manualmente.</li>
<li><strong>Motor de Reportes Científicos</strong>: Instala <strong>Quarto</strong> y <strong>TinyTeX</strong>, permitiendo la generación automática de informes en PDF y HTML con calidad editorial.</li>
<li><strong>Puente de Comunicación Maestro</strong>: Configura el archivo <code>Rprofile.site</code>, el cual actúa como el “cerebro” que permite a R ejecutar código de Julia y capturar gráficos de Python de forma transparente.</li>
</ul>
<div class="sourceCode" id="cb12"><pre class="sourceCode dockerfile code-with-copy"><code class="sourceCode dockerfile"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Imagen base</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Imagen oficial de OSGeo con GDAL completo, PROJ, GEOS y soporte</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co"># raster/vector profesional. Base estándar en SIG reproducible.</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> ghcr.io/osgeo/gdal:ubuntu-full-latest</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Base, Locales y Pandoc</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Configuración UTF-8 para evitar problemas con acentos,</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="co"># R, Python, Julia, LaTeX y generación de documentos.</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="kw">ENV</span> LANG=en_US.UTF-8</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a><span class="kw">ENV</span> LC_ALL=en_US.UTF-8</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Herramientas base del sistema:</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a><span class="co"># - compiladores y toolchain (C/C++)</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a><span class="co"># - git / curl / wget para descargas</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a><span class="co"># - pandoc como motor universal de documentos</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">apt-get</span> update <span class="kw">&amp;&amp;</span> <span class="ex">apt-get</span> install <span class="at">-y</span> locales git curl wget ca-certificates <span class="dt">\</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    build-essential cmake libtool automake pkg-config software-properties-common <span class="dt">\</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    pandoc <span class="kw">&amp;&amp;</span> <span class="dt">\</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    <span class="ex">locale-gen</span> en_US.UTF-8</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Librerías criptográficas y de red</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Necesarias para:</span></span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a><span class="co"># - conexiones HTTPS</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a><span class="co"># - Julia</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a><span class="co"># - GDAL</span></span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="co"># - acceso a APIs externas</span></span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">apt-get</span> update <span class="kw">&amp;&amp;</span> <span class="ex">apt-get</span> install <span class="at">-y</span> <span class="at">--no-install-recommends</span> <span class="dt">\</span></span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>    libmbedtls-dev <span class="dt">\</span></span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>    libnng-dev <span class="dt">\</span></span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a>    libssl-dev <span class="dt">\</span></span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a>    libxml2-dev <span class="dt">\</span></span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a>    libcurl4-openssl-dev <span class="dt">\</span></span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a>    git <span class="dt">\</span></span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a>    cmake</span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. R, Python y dependencias de sistema</span></span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Incluye soporte para:</span></span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a><span class="co"># - SIG (GDAL / GEOS / PROJ)</span></span>
<span id="cb12-53"><a href="#cb12-53" aria-hidden="true" tabindex="-1"></a><span class="co"># - NetCDF / HDF5</span></span>
<span id="cb12-54"><a href="#cb12-54" aria-hidden="true" tabindex="-1"></a><span class="co"># - NASA / Copernicus</span></span>
<span id="cb12-55"><a href="#cb12-55" aria-hidden="true" tabindex="-1"></a><span class="co"># - WhiteboxTools</span></span>
<span id="cb12-56"><a href="#cb12-56" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb12-57"><a href="#cb12-57" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">apt-get</span> update <span class="kw">&amp;&amp;</span> <span class="ex">apt-get</span> install <span class="at">-y</span> <span class="at">--no-install-recommends</span> <span class="dt">\</span></span>
<span id="cb12-58"><a href="#cb12-58" aria-hidden="true" tabindex="-1"></a>    r-base r-base-dev python3-pip python3-dev <span class="dt">\</span></span>
<span id="cb12-59"><a href="#cb12-59" aria-hidden="true" tabindex="-1"></a>    psmisc lsof net-tools ffmpeg <span class="dt">\</span></span>
<span id="cb12-60"><a href="#cb12-60" aria-hidden="true" tabindex="-1"></a>    libpng-dev libcairo2-dev libsystemd-dev <span class="dt">\</span></span>
<span id="cb12-61"><a href="#cb12-61" aria-hidden="true" tabindex="-1"></a>    libfontconfig1-dev libfreetype6-dev <span class="dt">\</span></span>
<span id="cb12-62"><a href="#cb12-62" aria-hidden="true" tabindex="-1"></a>    libharfbuzz-dev libfribidi-dev <span class="dt">\</span></span>
<span id="cb12-63"><a href="#cb12-63" aria-hidden="true" tabindex="-1"></a>    libcurl4-openssl-dev libsqlite3-dev libxml2-dev libssl-dev <span class="dt">\</span></span>
<span id="cb12-64"><a href="#cb12-64" aria-hidden="true" tabindex="-1"></a>    libgeos-dev libproj-dev libgdal-dev libudunits2-dev <span class="dt">\</span></span>
<span id="cb12-65"><a href="#cb12-65" aria-hidden="true" tabindex="-1"></a>    libgit2-dev libssh2-1-dev libxt-dev libglpk-dev libmount-dev <span class="dt">\</span></span>
<span id="cb12-66"><a href="#cb12-66" aria-hidden="true" tabindex="-1"></a>    libmagick++-dev libpcre2-dev libnetcdf-dev libhdf5-dev <span class="dt">\</span></span>
<span id="cb12-67"><a href="#cb12-67" aria-hidden="true" tabindex="-1"></a>    libxt6 libxrender1 libxext6 default-jdk <span class="dt">\</span></span>
<span id="cb12-68"><a href="#cb12-68" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Elimina la restricción de pip en Debian/Ubuntu modernos</span></span>
<span id="cb12-69"><a href="#cb12-69" aria-hidden="true" tabindex="-1"></a>    &amp;&amp; rm /usr/lib/python3.12/EXTERNALLY-MANAGED || true &amp;&amp; <span class="op">\</span></span>
<span id="cb12-70"><a href="#cb12-70" aria-hidden="true" tabindex="-1"></a>    rm -rf /var/lib/apt/lists/*</span>
<span id="cb12-71"><a href="#cb12-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-72"><a href="#cb12-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-73"><a href="#cb12-73" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb12-74"><a href="#cb12-74" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Quarto CLI y TinyTeX</span></span>
<span id="cb12-75"><a href="#cb12-75" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb12-76"><a href="#cb12-76" aria-hidden="true" tabindex="-1"></a><span class="co"># Quarto: documentos reproducibles (HTML, PDF, slides)</span></span>
<span id="cb12-77"><a href="#cb12-77" aria-hidden="true" tabindex="-1"></a><span class="co"># TinyTeX: LaTeX liviano para generación de PDF</span></span>
<span id="cb12-78"><a href="#cb12-78" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb12-79"><a href="#cb12-79" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">curl</span> <span class="at">-LO</span> https://github.com/quarto-dev/quarto-cli/releases/download/v1.4.550/quarto-1.4.550-linux-amd64.deb <span class="dt">\</span></span>
<span id="cb12-80"><a href="#cb12-80" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&amp;&amp;</span> <span class="ex">dpkg</span> <span class="at">-i</span> quarto-1.4.550-linux-amd64.deb <span class="kw">&amp;&amp;</span> <span class="fu">rm</span> quarto-1.4.550-linux-amd64.deb <span class="dt">\</span></span>
<span id="cb12-81"><a href="#cb12-81" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&amp;&amp;</span> <span class="ex">quarto</span> install tinytex <span class="at">--no-prompt</span></span>
<span id="cb12-82"><a href="#cb12-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-83"><a href="#cb12-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-84"><a href="#cb12-84" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb12-85"><a href="#cb12-85" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Python Stack</span></span>
<span id="cb12-86"><a href="#cb12-86" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb12-87"><a href="#cb12-87" aria-hidden="true" tabindex="-1"></a><span class="co"># Librerías SIG, ciencia de datos, notebooks y visualización</span></span>
<span id="cb12-88"><a href="#cb12-88" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb12-89"><a href="#cb12-89" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">pip3</span> install <span class="at">--upgrade</span> <span class="at">--ignore-installed</span> <span class="at">--break-system-packages</span> <span class="dt">\</span></span>
<span id="cb12-90"><a href="#cb12-90" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ya estaban:</span></span>
<span id="cb12-91"><a href="#cb12-91" aria-hidden="true" tabindex="-1"></a>    shapely matplotlib numpy geopandas fiona pyyaml nbformat nbclient ipykernel <span class="op">\</span></span>
<span id="cb12-92"><a href="#cb12-92" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Nuevos agregados:</span></span>
<span id="cb12-93"><a href="#cb12-93" aria-hidden="true" tabindex="-1"></a>    pandas rasterio rasterstats scipy psycopg2 pysal earthaccess cdsapi leafmap <span class="op">\</span></span>
<span id="cb12-94"><a href="#cb12-94" aria-hidden="true" tabindex="-1"></a>    geemap segment-geospatial geoai-py lidar pygis whitebox whiteboxgui streamlit <span class="op">\</span></span>
<span id="cb12-95"><a href="#cb12-95" aria-hidden="true" tabindex="-1"></a>    ghp-import jupyter-book jupyterlab jupytext mystmd notebook</span>
<span id="cb12-96"><a href="#cb12-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-97"><a href="#cb12-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-98"><a href="#cb12-98" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb12-99"><a href="#cb12-99" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. R Stack</span></span>
<span id="cb12-100"><a href="#cb12-100" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb12-101"><a href="#cb12-101" aria-hidden="true" tabindex="-1"></a><span class="co"># Instalación desde CRAN optimizado de Posit para Linux</span></span>
<span id="cb12-102"><a href="#cb12-102" aria-hidden="true" tabindex="-1"></a><span class="co"># Incluye SIG, visualización, modelado y ML espacial</span></span>
<span id="cb12-103"><a href="#cb12-103" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb12-104"><a href="#cb12-104" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">R</span> <span class="at">-e</span> <span class="st">"options(timeout = 1000, Ncpus = parallel::detectCores(), repos = c(CRAN = 'https://packagemanager.posit.co/cran/__linux__/noble/latest')); </span><span class="dt">\</span></span>
<span id="cb12-105"><a href="#cb12-105" aria-hidden="true" tabindex="-1"></a><span class="st">    install.packages(c('ggplot2', 'patchwork', 'dplyr', 'remotes', 'languageserver', </span><span class="dt">\</span></span>
<span id="cb12-106"><a href="#cb12-106" aria-hidden="true" tabindex="-1"></a><span class="st">    'rmarkdown', 'units', 's2', 'sf', 'terra', 'stars', 'reticulate', 'IRkernel', </span><span class="dt">\</span></span>
<span id="cb12-107"><a href="#cb12-107" aria-hidden="true" tabindex="-1"></a><span class="st">    'unigd', 'cpp11', 'systemfonts', 'AsioHeaders', 'png', 'grid', 'JuliaCall', 'JuliaConnectoR', </span><span class="dt">\</span></span>
<span id="cb12-108"><a href="#cb12-108" aria-hidden="true" tabindex="-1"></a><span class="st">    # Nuevos CRAN:</span></span>
<span id="cb12-109"><a href="#cb12-109" aria-hidden="true" tabindex="-1"></a><span class="st">    'tidyverse', 'tmap', 'leaflet', 'googleway', 'ggspatial', 'mapview', 'plotly', </span><span class="dt">\</span></span>
<span id="cb12-110"><a href="#cb12-110" aria-hidden="true" tabindex="-1"></a><span class="st">    'rasterVis', 'cartogram', 'geogrid', 'geofacet', 'linemap', 'tanaka', 'rayshader', </span><span class="dt">\</span></span>
<span id="cb12-111"><a href="#cb12-111" aria-hidden="true" tabindex="-1"></a><span class="st">    'lwgeom', 'gstat', 'spdep', 'spatialreg', 'stplanr', 'sfnetworks', 'spatstat', </span><span class="dt">\</span></span>
<span id="cb12-112"><a href="#cb12-112" aria-hidden="true" tabindex="-1"></a><span class="st">    'stpp', 'magrittr', 'giscoR', 'caret', 'tidymodels', 'spatialsample', 'CAST', </span><span class="dt">\</span></span>
<span id="cb12-113"><a href="#cb12-113" aria-hidden="true" tabindex="-1"></a><span class="st">    'mlr3spatial', 'mlr3spatiotempcv', 'ncdf4', 'whitebox'))"</span></span>
<span id="cb12-114"><a href="#cb12-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-115"><a href="#cb12-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-116"><a href="#cb12-116" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb12-117"><a href="#cb12-117" aria-hidden="true" tabindex="-1"></a><span class="co"># Starsdata y repositorios específicos</span></span>
<span id="cb12-118"><a href="#cb12-118" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb12-119"><a href="#cb12-119" aria-hidden="true" tabindex="-1"></a><span class="co"># Se compila desde código fuente y se usan repos especiales</span></span>
<span id="cb12-120"><a href="#cb12-120" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb12-121"><a href="#cb12-121" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">R</span> <span class="at">-e</span> <span class="st">"options(timeout = 30000, Ncpus = parallel::detectCores()); </span><span class="dt">\</span></span>
<span id="cb12-122"><a href="#cb12-122" aria-hidden="true" tabindex="-1"></a><span class="st">    install.packages('starsdata', repos='https://cran.uni-muenster.de/pebesma/', type='source')"</span> <span class="kw">&amp;&amp;</span> <span class="dt">\</span></span>
<span id="cb12-123"><a href="#cb12-123" aria-hidden="true" tabindex="-1"></a>    <span class="ex">R</span> <span class="at">-e</span> <span class="st">"options(timeout = 2000, Ncpus = parallel::detectCores()); </span><span class="dt">\</span></span>
<span id="cb12-124"><a href="#cb12-124" aria-hidden="true" tabindex="-1"></a><span class="st">    install.packages(c('mlr3cmprsk', 'survdistr'), repos=c('https://mlr3learners.r-universe.dev', 'https://cloud.r-project.org')); </span><span class="dt">\</span></span>
<span id="cb12-125"><a href="#cb12-125" aria-hidden="true" tabindex="-1"></a><span class="st">    install.packages('geocompkg', repos=c('https://geocompr.r-universe.dev', 'https://cloud.r-project.org'), dependencies=TRUE); </span><span class="dt">\</span></span>
<span id="cb12-126"><a href="#cb12-126" aria-hidden="true" tabindex="-1"></a><span class="st">    whitebox::install_whitebox(); IRkernel::installspec(user = FALSE)"</span></span>
<span id="cb12-127"><a href="#cb12-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-128"><a href="#cb12-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-129"><a href="#cb12-129" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb12-130"><a href="#cb12-130" aria-hidden="true" tabindex="-1"></a><span class="co"># httpgd estable</span></span>
<span id="cb12-131"><a href="#cb12-131" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb12-132"><a href="#cb12-132" aria-hidden="true" tabindex="-1"></a><span class="co"># Dispositivo gráfico moderno para R (gráficos en navegador)</span></span>
<span id="cb12-133"><a href="#cb12-133" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb12-134"><a href="#cb12-134" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="fu">wget</span> https://cran.r-project.org/src/contrib/Archive/httpgd/httpgd_2.0.3.tar.gz <span class="kw">&amp;&amp;</span> <span class="dt">\</span></span>
<span id="cb12-135"><a href="#cb12-135" aria-hidden="true" tabindex="-1"></a>    <span class="ex">R</span> CMD INSTALL httpgd_2.0.3.tar.gz <span class="kw">&amp;&amp;</span> <span class="fu">rm</span> httpgd_2.0.3.tar.gz</span>
<span id="cb12-136"><a href="#cb12-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-137"><a href="#cb12-137" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb12-138"><a href="#cb12-138" aria-hidden="true" tabindex="-1"></a><span class="co"># 6. Puente Python ↔ R (Backend de Matplotlib para reticulate)</span></span>
<span id="cb12-139"><a href="#cb12-139" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb12-140"><a href="#cb12-140" aria-hidden="true" tabindex="-1"></a><span class="co"># Permite que gráficos de matplotlib generados desde Python</span></span>
<span id="cb12-141"><a href="#cb12-141" aria-hidden="true" tabindex="-1"></a><span class="co"># puedan ser capturados y mostrados correctamente desde R</span></span>
<span id="cb12-142"><a href="#cb12-142" aria-hidden="true" tabindex="-1"></a><span class="co"># usando reticulate (especialmente en notebooks y httpgd).</span></span>
<span id="cb12-143"><a href="#cb12-143" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb12-144"><a href="#cb12-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-145"><a href="#cb12-145" aria-hidden="true" tabindex="-1"></a><span class="co"># Creamos la estructura esperada por reticulate</span></span>
<span id="cb12-146"><a href="#cb12-146" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="fu">mkdir</span> <span class="at">-p</span> /usr/local/lib/python3.12/dist-packages/reticulate/matplotlib <span class="kw">&amp;&amp;</span> <span class="dt">\</span></span>
<span id="cb12-147"><a href="#cb12-147" aria-hidden="true" tabindex="-1"></a>    <span class="fu">touch</span> /usr/local/lib/python3.12/dist-packages/reticulate/__init__.py</span>
<span id="cb12-148"><a href="#cb12-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-149"><a href="#cb12-149" aria-hidden="true" tabindex="-1"></a><span class="co"># Definimos una función que R puede interceptar</span></span>
<span id="cb12-150"><a href="#cb12-150" aria-hidden="true" tabindex="-1"></a><span class="co"># para recibir el path de la imagen generada por Python</span></span>
<span id="cb12-151"><a href="#cb12-151" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="bu">printf</span> <span class="st">'def r_graphic_command(path):\n    import os\n    if os.path.exists(path): print(f"r_graphic_command: {path}")\n'</span> <span class="op">&gt;</span> /usr/local/lib/python3.12/dist-packages/reticulate/__init__.py</span>
<span id="cb12-152"><a href="#cb12-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-153"><a href="#cb12-153" aria-hidden="true" tabindex="-1"></a><span class="co"># Backend custom de matplotlib:</span></span>
<span id="cb12-154"><a href="#cb12-154" aria-hidden="true" tabindex="-1"></a><span class="co"># - Renderiza con Agg</span></span>
<span id="cb12-155"><a href="#cb12-155" aria-hidden="true" tabindex="-1"></a><span class="co"># - Guarda el gráfico como PNG temporal</span></span>
<span id="cb12-156"><a href="#cb12-156" aria-hidden="true" tabindex="-1"></a><span class="co"># - Notifica a R para que lo muestre</span></span>
<span id="cb12-157"><a href="#cb12-157" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="bu">printf</span> <span class="st">'import matplotlib\nfrom matplotlib.backends.backend_agg import FigureCanvasAgg\nfrom matplotlib.backend_bases import FigureManagerBase\n\ndef show(*args, **kwargs):\n    import os, tempfile, reticulate\n    fd, path = tempfile.mkstemp(suffix=".png")\n    os.close(fd)\n    matplotlib.pyplot.savefig(path)\n    if hasattr(reticulate, "r_graphic_command"):\n        reticulate.r_graphic_command(path)\n\nclass FigureManager(FigureManagerBase):\n    def show(self):\n        show()\n\ndef new_figure_manager(num, *args, **kwargs):\n    FigureClass = kwargs.pop("FigureClass", matplotlib.figure.Figure)\n    thisFig = FigureClass(*args, **kwargs)\n    return new_figure_manager_given_figure(num, thisFig)\n\ndef new_figure_manager_given_figure(num, figure):\n    canvas = FigureCanvasAgg(figure)\n    manager = FigureManager(canvas, num)\n    return manager\n\nFigureCanvas = FigureCanvasAgg\n'</span> <span class="op">&gt;</span> /usr/local/lib/python3.12/dist-packages/reticulate/matplotlib/backend.py</span>
<span id="cb12-158"><a href="#cb12-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-159"><a href="#cb12-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-160"><a href="#cb12-160" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb12-161"><a href="#cb12-161" aria-hidden="true" tabindex="-1"></a><span class="co"># 7. Julia: Instalación y Wrapper de Seguridad</span></span>
<span id="cb12-162"><a href="#cb12-162" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb12-163"><a href="#cb12-163" aria-hidden="true" tabindex="-1"></a><span class="co"># Se instala Julia binaria oficial y se fuerza el uso de</span></span>
<span id="cb12-164"><a href="#cb12-164" aria-hidden="true" tabindex="-1"></a><span class="co"># librerías del sistema para evitar conflictos con GDAL/OpenSSL</span></span>
<span id="cb12-165"><a href="#cb12-165" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb12-166"><a href="#cb12-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-167"><a href="#cb12-167" aria-hidden="true" tabindex="-1"></a><span class="co"># Versión fija de Julia (reproducibilidad total)</span></span>
<span id="cb12-168"><a href="#cb12-168" aria-hidden="true" tabindex="-1"></a><span class="kw">ENV</span> JULIA_VERSION=1.10.4</span>
<span id="cb12-169"><a href="#cb12-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-170"><a href="#cb12-170" aria-hidden="true" tabindex="-1"></a><span class="co"># Descarga e instalación manual de Julia</span></span>
<span id="cb12-171"><a href="#cb12-171" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="fu">wget</span> https://julialang-s3.julialang.org/bin/linux/x64/1.10/julia-<span class="va">${JULIA_VERSION}</span>-linux-x86_64.tar.gz <span class="dt">\</span></span>
<span id="cb12-172"><a href="#cb12-172" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&amp;&amp;</span> <span class="fu">tar</span> <span class="at">-xvzf</span> julia-<span class="va">${JULIA_VERSION}</span>-linux-x86_64.tar.gz <span class="kw">&amp;&amp;</span> <span class="fu">mv</span> julia-1.10.4 /opt/julia</span>
<span id="cb12-173"><a href="#cb12-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-174"><a href="#cb12-174" aria-hidden="true" tabindex="-1"></a><span class="co"># Wrapper de Julia:</span></span>
<span id="cb12-175"><a href="#cb12-175" aria-hidden="true" tabindex="-1"></a><span class="co"># - Fuerza LD_PRELOAD</span></span>
<span id="cb12-176"><a href="#cb12-176" aria-hidden="true" tabindex="-1"></a><span class="co"># - Evita conflictos de libcurl / libstdc++</span></span>
<span id="cb12-177"><a href="#cb12-177" aria-hidden="true" tabindex="-1"></a><span class="co"># - Garantiza compatibilidad con GDAL</span></span>
<span id="cb12-178"><a href="#cb12-178" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="bu">printf</span> <span class="st">'#!/bin/bash\nexport LD_PRELOAD=/usr/lib/x86_64-linux-gnu/libcurl.so.4:/usr/lib/x86_64-linux-gnu/libstdc++.so.6\nexport JULIA_PKG_USE_CLI_GIT=true\n/opt/julia/bin/julia "$@"\n'</span> <span class="op">&gt;</span> /usr/local/bin/julia <span class="kw">&amp;&amp;</span> <span class="fu">chmod</span> +x /usr/local/bin/julia</span>
<span id="cb12-179"><a href="#cb12-179" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-180"><a href="#cb12-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-181"><a href="#cb12-181" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb12-182"><a href="#cb12-182" aria-hidden="true" tabindex="-1"></a><span class="co"># 8. Julia: Configuración de librerías nativas</span></span>
<span id="cb12-183"><a href="#cb12-183" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb12-184"><a href="#cb12-184" aria-hidden="true" tabindex="-1"></a><span class="co"># Se fijan explícitamente las rutas del sistema para:</span></span>
<span id="cb12-185"><a href="#cb12-185" aria-hidden="true" tabindex="-1"></a><span class="co"># - GDAL</span></span>
<span id="cb12-186"><a href="#cb12-186" aria-hidden="true" tabindex="-1"></a><span class="co"># - GEOS</span></span>
<span id="cb12-187"><a href="#cb12-187" aria-hidden="true" tabindex="-1"></a><span class="co"># evitando que Julia use binarios incompatibles</span></span>
<span id="cb12-188"><a href="#cb12-188" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb12-189"><a href="#cb12-189" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="fu">mkdir</span> <span class="at">-p</span> /root/.julia/environments/v1.10 <span class="kw">&amp;&amp;</span> <span class="dt">\</span></span>
<span id="cb12-190"><a href="#cb12-190" aria-hidden="true" tabindex="-1"></a>    <span class="bu">printf</span> <span class="st">"[LocalPreferences]\nGDAL_jll = { libgdal_path = </span><span class="dt">\"</span><span class="st">/usr/lib/libgdal.so</span><span class="dt">\"</span><span class="st"> }\nGEOS_jll = { libgeos_path = </span><span class="dt">\"</span><span class="st">/usr/lib/x86_64-linux-gnu/libgeos_c.so</span><span class="dt">\"</span><span class="st"> }\n"</span> <span class="op">&gt;</span> /root/.julia/environments/v1.10/LocalPreferences.toml</span>
<span id="cb12-191"><a href="#cb12-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-192"><a href="#cb12-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-193"><a href="#cb12-193" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb12-194"><a href="#cb12-194" aria-hidden="true" tabindex="-1"></a><span class="co"># 9. Julia: Instalación de paquetes</span></span>
<span id="cb12-195"><a href="#cb12-195" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb12-196"><a href="#cb12-196" aria-hidden="true" tabindex="-1"></a><span class="co"># Stack SIG completo:</span></span>
<span id="cb12-197"><a href="#cb12-197" aria-hidden="true" tabindex="-1"></a><span class="co"># - Rasters, ArchGDAL, GeoStats, Makie</span></span>
<span id="cb12-198"><a href="#cb12-198" aria-hidden="true" tabindex="-1"></a><span class="co"># - Conectores DB, CSV, NetCDF</span></span>
<span id="cb12-199"><a href="#cb12-199" aria-hidden="true" tabindex="-1"></a><span class="co"># - Visualización y notebooks (IJulia)</span></span>
<span id="cb12-200"><a href="#cb12-200" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb12-201"><a href="#cb12-201" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">julia</span> <span class="at">-e</span> <span class="st">'using Pkg; Pkg.add(["Preferences", "Suppressor", "RCall", "LibGEOS", "Tables", "DataFrames", "Plots", \</span></span>
<span id="cb12-202"><a href="#cb12-202" aria-hidden="true" tabindex="-1"></a><span class="st">    "Statistics", "ArchGDAL", "LibPQ", "GeoDataFrames", "IJulia", "CSV", "CairoMakie", "AlgebraOfGraphics", \</span></span>
<span id="cb12-203"><a href="#cb12-203" aria-hidden="true" tabindex="-1"></a><span class="st">    "DimensionalData", "FlexiJoins", "GeoFormatTypes", "GeoInterface", "GeoJSON", "GeoMakie", "GeometryOps", \</span></span>
<span id="cb12-204"><a href="#cb12-204" aria-hidden="true" tabindex="-1"></a><span class="st">    "Makie", "MakieCore", "NaturalEarth", "Proj", "Rasters", "StatsBase", "Tyler", "GeoStats", "Graphs", \</span></span>
<span id="cb12-205"><a href="#cb12-205" aria-hidden="true" tabindex="-1"></a><span class="st">    "NCDatasets", "MetaGraphsNext"])'</span></span>
<span id="cb12-206"><a href="#cb12-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-207"><a href="#cb12-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-208"><a href="#cb12-208" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb12-209"><a href="#cb12-209" aria-hidden="true" tabindex="-1"></a><span class="co"># Cirugía de librerías (OpenSSL)</span></span>
<span id="cb12-210"><a href="#cb12-210" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb12-211"><a href="#cb12-211" aria-hidden="true" tabindex="-1"></a><span class="co"># Fuerza a Julia a usar OpenSSL del sistema (Ubuntu Noble)</span></span>
<span id="cb12-212"><a href="#cb12-212" aria-hidden="true" tabindex="-1"></a><span class="co"># Evita errores de TLS y descargas de paquetes</span></span>
<span id="cb12-213"><a href="#cb12-213" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb12-214"><a href="#cb12-214" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="fu">find</span> /root/.julia/artifacts <span class="at">-name</span> <span class="st">"libssl.so*"</span> <span class="at">-exec</span> ln <span class="at">-sf</span> /usr/lib/x86_64-linux-gnu/libssl.so.3 {} <span class="dt">\;</span> <span class="kw">&amp;&amp;</span> <span class="dt">\</span></span>
<span id="cb12-215"><a href="#cb12-215" aria-hidden="true" tabindex="-1"></a>    <span class="fu">find</span> /root/.julia/artifacts <span class="at">-name</span> <span class="st">"libcrypto.so*"</span> <span class="at">-exec</span> ln <span class="at">-sf</span> /usr/lib/x86_64-linux-gnu/libcrypto.so.3 {} <span class="dt">\;</span></span>
<span id="cb12-216"><a href="#cb12-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-217"><a href="#cb12-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-218"><a href="#cb12-218" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb12-219"><a href="#cb12-219" aria-hidden="true" tabindex="-1"></a><span class="co"># Precompilación total de Julia</span></span>
<span id="cb12-220"><a href="#cb12-220" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb12-221"><a href="#cb12-221" aria-hidden="true" tabindex="-1"></a><span class="co"># Garantiza arranque instantáneo en:</span></span>
<span id="cb12-222"><a href="#cb12-222" aria-hidden="true" tabindex="-1"></a><span class="co"># - VSCode</span></span>
<span id="cb12-223"><a href="#cb12-223" aria-hidden="true" tabindex="-1"></a><span class="co"># - Jupyter</span></span>
<span id="cb12-224"><a href="#cb12-224" aria-hidden="true" tabindex="-1"></a><span class="co"># - IJulia</span></span>
<span id="cb12-225"><a href="#cb12-225" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb12-226"><a href="#cb12-226" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">julia</span> <span class="at">-e</span> <span class="st">'using Pkg; Pkg.precompile()'</span></span>
<span id="cb12-227"><a href="#cb12-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-228"><a href="#cb12-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-229"><a href="#cb12-229" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb12-230"><a href="#cb12-230" aria-hidden="true" tabindex="-1"></a><span class="co"># Configuración de paralelismo</span></span>
<span id="cb12-231"><a href="#cb12-231" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb12-232"><a href="#cb12-232" aria-hidden="true" tabindex="-1"></a><span class="co"># Julia usará automáticamente todos los núcleos disponibles</span></span>
<span id="cb12-233"><a href="#cb12-233" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb12-234"><a href="#cb12-234" aria-hidden="true" tabindex="-1"></a><span class="kw">ENV</span> JULIA_NUM_THREADS=auto</span>
<span id="cb12-235"><a href="#cb12-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-236"><a href="#cb12-236" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb12-237"><a href="#cb12-237" aria-hidden="true" tabindex="-1"></a><span class="co"># 10. CONFIGURACIÓN MAESTRA Rprofile.site</span></span>
<span id="cb12-238"><a href="#cb12-238" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb12-239"><a href="#cb12-239" aria-hidden="true" tabindex="-1"></a><span class="co"># Este archivo se ejecuta automáticamente cada vez que inicia R.</span></span>
<span id="cb12-240"><a href="#cb12-240" aria-hidden="true" tabindex="-1"></a><span class="co"># Centraliza la integración R ↔ Julia ↔ Python ↔ VSCode.</span></span>
<span id="cb12-241"><a href="#cb12-241" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb12-242"><a href="#cb12-242" aria-hidden="true" tabindex="-1"></a><span class="co"># Build 47.42:</span></span>
<span id="cb12-243"><a href="#cb12-243" aria-hidden="true" tabindex="-1"></a><span class="co"># - Control de DPI, tamaño y fuentes</span></span>
<span id="cb12-244"><a href="#cb12-244" aria-hidden="true" tabindex="-1"></a><span class="co"># - Ejecución segura de Julia desde R</span></span>
<span id="cb12-245"><a href="#cb12-245" aria-hidden="true" tabindex="-1"></a><span class="co"># - Renderizado consistente de gráficos</span></span>
<span id="cb12-246"><a href="#cb12-246" aria-hidden="true" tabindex="-1"></a><span class="co"># - Hook para Matplotlib vía reticulate</span></span>
<span id="cb12-247"><a href="#cb12-247" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb12-248"><a href="#cb12-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-249"><a href="#cb12-249" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="fu">cat</span> <span class="op">&lt;&lt; 'EOF'</span> <span class="op">&gt;</span> /usr/lib/R/etc/Rprofile.site</span>
<span id="cb12-250"><a href="#cb12-250" aria-hidden="true" tabindex="-1"></a><span class="st"># ============================================================</span></span>
<span id="cb12-251"><a href="#cb12-251" aria-hidden="true" tabindex="-1"></a><span class="st"># --- 1. AJUSTES DE SISTEMA ---</span></span>
<span id="cb12-252"><a href="#cb12-252" aria-hidden="true" tabindex="-1"></a><span class="st"># ------------------------------------------------------------</span></span>
<span id="cb12-253"><a href="#cb12-253" aria-hidden="true" tabindex="-1"></a><span class="st"># Variables globales para que R sepa dónde encontrar:</span></span>
<span id="cb12-254"><a href="#cb12-254" aria-hidden="true" tabindex="-1"></a><span class="st"># - Julia</span></span>
<span id="cb12-255"><a href="#cb12-255" aria-hidden="true" tabindex="-1"></a><span class="st"># - Python usado por Quarto</span></span>
<span id="cb12-256"><a href="#cb12-256" aria-hidden="true" tabindex="-1"></a><span class="st"># ============================================================</span></span>
<span id="cb12-257"><a href="#cb12-257" aria-hidden="true" tabindex="-1"></a><span class="st">Sys.setenv(JULIA_BINDIR = "/opt/julia/bin")</span></span>
<span id="cb12-258"><a href="#cb12-258" aria-hidden="true" tabindex="-1"></a><span class="st">Sys.setenv(QUARTO_PYTHON = "/usr/bin/python3")</span></span>
<span id="cb12-259"><a href="#cb12-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-260"><a href="#cb12-260" aria-hidden="true" tabindex="-1"></a><span class="st"># ============================================================</span></span>
<span id="cb12-261"><a href="#cb12-261" aria-hidden="true" tabindex="-1"></a><span class="st"># Código Julia embebido (auto-sanable)</span></span>
<span id="cb12-262"><a href="#cb12-262" aria-hidden="true" tabindex="-1"></a><span class="st"># ------------------------------------------------------------</span></span>
<span id="cb12-263"><a href="#cb12-263" aria-hidden="true" tabindex="-1"></a><span class="st"># Se define como string para:</span></span>
<span id="cb12-264"><a href="#cb12-264" aria-hidden="true" tabindex="-1"></a><span class="st"># - Inyectarse dinámicamente en Julia</span></span>
<span id="cb12-265"><a href="#cb12-265" aria-hidden="true" tabindex="-1"></a><span class="st"># - Evitar errores si el kernel se reinicia</span></span>
<span id="cb12-266"><a href="#cb12-266" aria-hidden="true" tabindex="-1"></a><span class="st"># - Garantizar reproducibilidad en notebooks</span></span>
<span id="cb12-267"><a href="#cb12-267" aria-hidden="true" tabindex="-1"></a><span class="st"># ============================================================</span></span>
<span id="cb12-268"><a href="#cb12-268" aria-hidden="true" tabindex="-1"></a><span class="st">.unal_julia_code &lt;- '</span></span>
<span id="cb12-269"><a href="#cb12-269" aria-hidden="true" tabindex="-1"></a><span class="st">using Suppressor, Plots, Statistics</span></span>
<span id="cb12-270"><a href="#cb12-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-271"><a href="#cb12-271" aria-hidden="true" tabindex="-1"></a><span class="st"># Ejecutor central de código Julia desde R</span></span>
<span id="cb12-272"><a href="#cb12-272" aria-hidden="true" tabindex="-1"></a><span class="st"># - Evalúa múltiples expresiones</span></span>
<span id="cb12-273"><a href="#cb12-273" aria-hidden="true" tabindex="-1"></a><span class="st"># - Captura stdout</span></span>
<span id="cb12-274"><a href="#cb12-274" aria-hidden="true" tabindex="-1"></a><span class="st"># - Maneja gráficos y texto</span></span>
<span id="cb12-275"><a href="#cb12-275" aria-hidden="true" tabindex="-1"></a><span class="st">function _unal_core_executor(code, is_plot, filename, dpi, w, h, fs)</span></span>
<span id="cb12-276"><a href="#cb12-276" aria-hidden="true" tabindex="-1"></a><span class="st">    @capture_out begin</span></span>
<span id="cb12-277"><a href="#cb12-277" aria-hidden="true" tabindex="-1"></a><span class="st">        if is_plot</span></span>
<span id="cb12-278"><a href="#cb12-278" aria-hidden="true" tabindex="-1"></a><span class="st">            # Parámetros gráficos homogéneos (DPI, tamaño, fuentes)</span></span>
<span id="cb12-279"><a href="#cb12-279" aria-hidden="true" tabindex="-1"></a><span class="st">            default(dpi=dpi, size=(w, h), titlefontsize=fs+2, </span></span>
<span id="cb12-280"><a href="#cb12-280" aria-hidden="true" tabindex="-1"></a><span class="st">                    guidefontsize=fs, tickfontsize=fs-2, legendfontsize=fs-1)</span></span>
<span id="cb12-281"><a href="#cb12-281" aria-hidden="true" tabindex="-1"></a><span class="st">        end</span></span>
<span id="cb12-282"><a href="#cb12-282" aria-hidden="true" tabindex="-1"></a><span class="st">        pos = 1</span></span>
<span id="cb12-283"><a href="#cb12-283" aria-hidden="true" tabindex="-1"></a><span class="st">        while pos &lt;= lastindex(code)</span></span>
<span id="cb12-284"><a href="#cb12-284" aria-hidden="true" tabindex="-1"></a><span class="st">            start_idx = pos</span></span>
<span id="cb12-285"><a href="#cb12-285" aria-hidden="true" tabindex="-1"></a><span class="st">            try</span></span>
<span id="cb12-286"><a href="#cb12-286" aria-hidden="true" tabindex="-1"></a><span class="st">                ex, pos = Meta.parse(code, pos)</span></span>
<span id="cb12-287"><a href="#cb12-287" aria-hidden="true" tabindex="-1"></a><span class="st">                cmd_part = strip(code[start_idx:prevind(code, pos)])</span></span>
<span id="cb12-288"><a href="#cb12-288" aria-hidden="true" tabindex="-1"></a><span class="st">                if !isempty(cmd_part)</span></span>
<span id="cb12-289"><a href="#cb12-289" aria-hidden="true" tabindex="-1"></a><span class="st">                    println("julia&gt; ", cmd_part)</span></span>
<span id="cb12-290"><a href="#cb12-290" aria-hidden="true" tabindex="-1"></a><span class="st">                    res = eval(ex)</span></span>
<span id="cb12-291"><a href="#cb12-291" aria-hidden="true" tabindex="-1"></a><span class="st">                    if res !== nothing &amp;&amp; !(res isa Plots.Plot)</span></span>
<span id="cb12-292"><a href="#cb12-292" aria-hidden="true" tabindex="-1"></a><span class="st">                        show(stdout, MIME("text/plain"), res)</span></span>
<span id="cb12-293"><a href="#cb12-293" aria-hidden="true" tabindex="-1"></a><span class="st">                        println()</span></span>
<span id="cb12-294"><a href="#cb12-294" aria-hidden="true" tabindex="-1"></a><span class="st">                    end</span></span>
<span id="cb12-295"><a href="#cb12-295" aria-hidden="true" tabindex="-1"></a><span class="st">                    println() </span></span>
<span id="cb12-296"><a href="#cb12-296" aria-hidden="true" tabindex="-1"></a><span class="st">                end</span></span>
<span id="cb12-297"><a href="#cb12-297" aria-hidden="true" tabindex="-1"></a><span class="st">            catch e</span></span>
<span id="cb12-298"><a href="#cb12-298" aria-hidden="true" tabindex="-1"></a><span class="st">                println("julia&gt; Error: ", e)</span></span>
<span id="cb12-299"><a href="#cb12-299" aria-hidden="true" tabindex="-1"></a><span class="st">                break</span></span>
<span id="cb12-300"><a href="#cb12-300" aria-hidden="true" tabindex="-1"></a><span class="st">            end</span></span>
<span id="cb12-301"><a href="#cb12-301" aria-hidden="true" tabindex="-1"></a><span class="st">        end</span></span>
<span id="cb12-302"><a href="#cb12-302" aria-hidden="true" tabindex="-1"></a><span class="st">        # Guardado del gráfico si aplica</span></span>
<span id="cb12-303"><a href="#cb12-303" aria-hidden="true" tabindex="-1"></a><span class="st">        if is_plot &amp;&amp; current() !== nothing; savefig(current(), filename); end</span></span>
<span id="cb12-304"><a href="#cb12-304" aria-hidden="true" tabindex="-1"></a><span class="st">    end</span></span>
<span id="cb12-305"><a href="#cb12-305" aria-hidden="true" tabindex="-1"></a><span class="st">end</span></span>
<span id="cb12-306"><a href="#cb12-306" aria-hidden="true" tabindex="-1"></a><span class="st">'</span></span>
<span id="cb12-307"><a href="#cb12-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-308"><a href="#cb12-308" aria-hidden="true" tabindex="-1"></a><span class="st"># ============================================================</span></span>
<span id="cb12-309"><a href="#cb12-309" aria-hidden="true" tabindex="-1"></a><span class="st"># Inicialización segura de Julia</span></span>
<span id="cb12-310"><a href="#cb12-310" aria-hidden="true" tabindex="-1"></a><span class="st"># ------------------------------------------------------------</span></span>
<span id="cb12-311"><a href="#cb12-311" aria-hidden="true" tabindex="-1"></a><span class="st"># - Verifica que JuliaConnectoR esté disponible</span></span>
<span id="cb12-312"><a href="#cb12-312" aria-hidden="true" tabindex="-1"></a><span class="st"># - Inyecta el ejecutor solo una vez por sesión</span></span>
<span id="cb12-313"><a href="#cb12-313" aria-hidden="true" tabindex="-1"></a><span class="st"># ============================================================</span></span>
<span id="cb12-314"><a href="#cb12-314" aria-hidden="true" tabindex="-1"></a><span class="st">.ensure_julia_ready &lt;- function() {</span></span>
<span id="cb12-315"><a href="#cb12-315" aria-hidden="true" tabindex="-1"></a><span class="st">  if (!requireNamespace("JuliaConnectoR", quietly = TRUE)) stop("JuliaConnectoR missing")</span></span>
<span id="cb12-316"><a href="#cb12-316" aria-hidden="true" tabindex="-1"></a><span class="st">  if (!JuliaConnectoR::juliaEval('isdefined(Main, :_unal_core_executor)')) {</span></span>
<span id="cb12-317"><a href="#cb12-317" aria-hidden="true" tabindex="-1"></a><span class="st">    JuliaConnectoR::juliaEval(.unal_julia_code)</span></span>
<span id="cb12-318"><a href="#cb12-318" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb12-319"><a href="#cb12-319" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb12-320"><a href="#cb12-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-321"><a href="#cb12-321" aria-hidden="true" tabindex="-1"></a><span class="st"># ============================================================</span></span>
<span id="cb12-322"><a href="#cb12-322" aria-hidden="true" tabindex="-1"></a><span class="st"># j_eval(): ejecutar código Julia (solo texto)</span></span>
<span id="cb12-323"><a href="#cb12-323" aria-hidden="true" tabindex="-1"></a><span class="st"># ------------------------------------------------------------</span></span>
<span id="cb12-324"><a href="#cb12-324" aria-hidden="true" tabindex="-1"></a><span class="st"># Uso típico:</span></span>
<span id="cb12-325"><a href="#cb12-325" aria-hidden="true" tabindex="-1"></a><span class="st"># j_eval("1 + 1")</span></span>
<span id="cb12-326"><a href="#cb12-326" aria-hidden="true" tabindex="-1"></a><span class="st"># ============================================================</span></span>
<span id="cb12-327"><a href="#cb12-327" aria-hidden="true" tabindex="-1"></a><span class="st">j_eval &lt;- function(cmd) {</span></span>
<span id="cb12-328"><a href="#cb12-328" aria-hidden="true" tabindex="-1"></a><span class="st">  .ensure_julia_ready()</span></span>
<span id="cb12-329"><a href="#cb12-329" aria-hidden="true" tabindex="-1"></a><span class="st">  cat(JuliaConnectoR::juliaCall("_unal_core_executor", cmd, FALSE, "", 72, 800, 500, 12))</span></span>
<span id="cb12-330"><a href="#cb12-330" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb12-331"><a href="#cb12-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-332"><a href="#cb12-332" aria-hidden="true" tabindex="-1"></a><span class="st"># ============================================================</span></span>
<span id="cb12-333"><a href="#cb12-333" aria-hidden="true" tabindex="-1"></a><span class="st"># j_plot(): ejecutar código Julia con gráficos</span></span>
<span id="cb12-334"><a href="#cb12-334" aria-hidden="true" tabindex="-1"></a><span class="st"># ------------------------------------------------------------</span></span>
<span id="cb12-335"><a href="#cb12-335" aria-hidden="true" tabindex="-1"></a><span class="st"># - Guarda el gráfico en PNG</span></span>
<span id="cb12-336"><a href="#cb12-336" aria-hidden="true" tabindex="-1"></a><span class="st"># - Lo renderiza directamente en R</span></span>
<span id="cb12-337"><a href="#cb12-337" aria-hidden="true" tabindex="-1"></a><span class="st"># ============================================================</span></span>
<span id="cb12-338"><a href="#cb12-338" aria-hidden="true" tabindex="-1"></a><span class="st">j_plot &lt;- function(cmd, n = "tmp_plot.png", dpi = 300, w = 800, h = NULL, ratio = 1.6, fontsize = 12) {</span></span>
<span id="cb12-339"><a href="#cb12-339" aria-hidden="true" tabindex="-1"></a><span class="st">  .ensure_julia_ready()</span></span>
<span id="cb12-340"><a href="#cb12-340" aria-hidden="true" tabindex="-1"></a><span class="st">  if (is.null(h)) h &lt;- round(w / ratio)</span></span>
<span id="cb12-341"><a href="#cb12-341" aria-hidden="true" tabindex="-1"></a><span class="st">  log_out &lt;- JuliaConnectoR::juliaCall("_unal_core_executor", cmd, TRUE, n, dpi, as.integer(w), as.integer(h), as.integer(fontsize))</span></span>
<span id="cb12-342"><a href="#cb12-342" aria-hidden="true" tabindex="-1"></a><span class="st">  if (nchar(log_out) &gt; 0) cat(log_out)</span></span>
<span id="cb12-343"><a href="#cb12-343" aria-hidden="true" tabindex="-1"></a><span class="st">  if (file.exists(n)) {</span></span>
<span id="cb12-344"><a href="#cb12-344" aria-hidden="true" tabindex="-1"></a><span class="st">    img &lt;- png::readPNG(n)</span></span>
<span id="cb12-345"><a href="#cb12-345" aria-hidden="true" tabindex="-1"></a><span class="st">    grid::grid.newpage()</span></span>
<span id="cb12-346"><a href="#cb12-346" aria-hidden="true" tabindex="-1"></a><span class="st">    grid::grid.raster(img)</span></span>
<span id="cb12-347"><a href="#cb12-347" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb12-348"><a href="#cb12-348" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb12-349"><a href="#cb12-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-350"><a href="#cb12-350" aria-hidden="true" tabindex="-1"></a><span class="st"># ============================================================</span></span>
<span id="cb12-351"><a href="#cb12-351" aria-hidden="true" tabindex="-1"></a><span class="st"># --- 2. CARGA DE LIBRERÍAS Y DISPOSITIVOS ---</span></span>
<span id="cb12-352"><a href="#cb12-352" aria-hidden="true" tabindex="-1"></a><span class="st"># ------------------------------------------------------------</span></span>
<span id="cb12-353"><a href="#cb12-353" aria-hidden="true" tabindex="-1"></a><span class="st"># Librerías base para renderizar imágenes</span></span>
<span id="cb12-354"><a href="#cb12-354" aria-hidden="true" tabindex="-1"></a><span class="st"># ============================================================</span></span>
<span id="cb12-355"><a href="#cb12-355" aria-hidden="true" tabindex="-1"></a><span class="st">library(png)</span></span>
<span id="cb12-356"><a href="#cb12-356" aria-hidden="true" tabindex="-1"></a><span class="st">library(grid)</span></span>
<span id="cb12-357"><a href="#cb12-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-358"><a href="#cb12-358" aria-hidden="true" tabindex="-1"></a><span class="st">if (interactive()) {</span></span>
<span id="cb12-359"><a href="#cb12-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-360"><a href="#cb12-360" aria-hidden="true" tabindex="-1"></a><span class="st">  # ==========================================================</span></span>
<span id="cb12-361"><a href="#cb12-361" aria-hidden="true" tabindex="-1"></a><span class="st">  # Visor gráfico httpgd (VSCode / navegador)</span></span>
<span id="cb12-362"><a href="#cb12-362" aria-hidden="true" tabindex="-1"></a><span class="st">  # ----------------------------------------------------------</span></span>
<span id="cb12-363"><a href="#cb12-363" aria-hidden="true" tabindex="-1"></a><span class="st">  # Permite gráficos interactivos persistentes</span></span>
<span id="cb12-364"><a href="#cb12-364" aria-hidden="true" tabindex="-1"></a><span class="st">  # ==========================================================</span></span>
<span id="cb12-365"><a href="#cb12-365" aria-hidden="true" tabindex="-1"></a><span class="st">  if (requireNamespace("httpgd", quietly = TRUE)) {</span></span>
<span id="cb12-366"><a href="#cb12-366" aria-hidden="true" tabindex="-1"></a><span class="st">    options(device = "httpgd", httpgd.host = "0.0.0.0", httpgd.port = 8787, httpgd.token = FALSE)</span></span>
<span id="cb12-367"><a href="#cb12-367" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb12-368"><a href="#cb12-368" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb12-369"><a href="#cb12-369" aria-hidden="true" tabindex="-1"></a><span class="st">  # ==========================================================</span></span>
<span id="cb12-370"><a href="#cb12-370" aria-hidden="true" tabindex="-1"></a><span class="st">  # Hook Python → R (Matplotlib)</span></span>
<span id="cb12-371"><a href="#cb12-371" aria-hidden="true" tabindex="-1"></a><span class="st">  # ----------------------------------------------------------</span></span>
<span id="cb12-372"><a href="#cb12-372" aria-hidden="true" tabindex="-1"></a><span class="st">  # Captura gráficos de matplotlib y los muestra en R</span></span>
<span id="cb12-373"><a href="#cb12-373" aria-hidden="true" tabindex="-1"></a><span class="st">  # usando el backend custom definido en Docker</span></span>
<span id="cb12-374"><a href="#cb12-374" aria-hidden="true" tabindex="-1"></a><span class="st">  # ==========================================================</span></span>
<span id="cb12-375"><a href="#cb12-375" aria-hidden="true" tabindex="-1"></a><span class="st">  setHook(packageEvent("reticulate", "onLoad"), function(...) {</span></span>
<span id="cb12-376"><a href="#cb12-376" aria-hidden="true" tabindex="-1"></a><span class="st">    try({</span></span>
<span id="cb12-377"><a href="#cb12-377" aria-hidden="true" tabindex="-1"></a><span class="st">      ret_py &lt;- reticulate::import("reticulate", delay_load = TRUE)</span></span>
<span id="cb12-378"><a href="#cb12-378" aria-hidden="true" tabindex="-1"></a><span class="st">      reticulate::py_set_attr(ret_py, "r_graphic_command", function(path) {</span></span>
<span id="cb12-379"><a href="#cb12-379" aria-hidden="true" tabindex="-1"></a><span class="st">        if (file.exists(path)) {</span></span>
<span id="cb12-380"><a href="#cb12-380" aria-hidden="true" tabindex="-1"></a><span class="st">          img &lt;- png::readPNG(path)</span></span>
<span id="cb12-381"><a href="#cb12-381" aria-hidden="true" tabindex="-1"></a><span class="st">          grid::grid.newpage()</span></span>
<span id="cb12-382"><a href="#cb12-382" aria-hidden="true" tabindex="-1"></a><span class="st">          grid::grid.raster(img)</span></span>
<span id="cb12-383"><a href="#cb12-383" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb12-384"><a href="#cb12-384" aria-hidden="true" tabindex="-1"></a><span class="st">      })</span></span>
<span id="cb12-385"><a href="#cb12-385" aria-hidden="true" tabindex="-1"></a><span class="st">      reticulate::py_run_string("import matplotlib; matplotlib.use('module://reticulate.matplotlib.backend')")</span></span>
<span id="cb12-386"><a href="#cb12-386" aria-hidden="true" tabindex="-1"></a><span class="st">    }, silent = TRUE)</span></span>
<span id="cb12-387"><a href="#cb12-387" aria-hidden="true" tabindex="-1"></a><span class="st">  })</span></span>
<span id="cb12-388"><a href="#cb12-388" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb12-389"><a href="#cb12-389" aria-hidden="true" tabindex="-1"></a><span class="op">EOF</span></span>
<span id="cb12-390"><a href="#cb12-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-391"><a href="#cb12-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-392"><a href="#cb12-392" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb12-393"><a href="#cb12-393" aria-hidden="true" tabindex="-1"></a><span class="co"># Compatibilidad multi-R (opcional)</span></span>
<span id="cb12-394"><a href="#cb12-394" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb12-395"><a href="#cb12-395" aria-hidden="true" tabindex="-1"></a><span class="co"># Permite que R instalado en rutas alternativas use</span></span>
<span id="cb12-396"><a href="#cb12-396" aria-hidden="true" tabindex="-1"></a><span class="co"># exactamente la misma configuración</span></span>
<span id="cb12-397"><a href="#cb12-397" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb12-398"><a href="#cb12-398" aria-hidden="true" tabindex="-1"></a><span class="co">#RUN cp /usr/lib/R/etc/Rprofile.site /etc/R/Rprofile.site</span></span>
<span id="cb12-399"><a href="#cb12-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-400"><a href="#cb12-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-401"><a href="#cb12-401" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb12-402"><a href="#cb12-402" aria-hidden="true" tabindex="-1"></a><span class="co"># 10. Finalización del contenedor</span></span>
<span id="cb12-403"><a href="#cb12-403" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb12-404"><a href="#cb12-404" aria-hidden="true" tabindex="-1"></a><span class="co"># Directorio de trabajo compartido</span></span>
<span id="cb12-405"><a href="#cb12-405" aria-hidden="true" tabindex="-1"></a><span class="co"># Permisos amplios para docencia</span></span>
<span id="cb12-406"><a href="#cb12-406" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb12-407"><a href="#cb12-407" aria-hidden="true" tabindex="-1"></a><span class="kw">WORKDIR</span> /home/rstudio/work</span>
<span id="cb12-408"><a href="#cb12-408" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="fu">chmod</span> <span class="at">-R</span> 777 /home/rstudio/work</span>
<span id="cb12-409"><a href="#cb12-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-410"><a href="#cb12-410" aria-hidden="true" tabindex="-1"></a><span class="co"># Puertos:</span></span>
<span id="cb12-411"><a href="#cb12-411" aria-hidden="true" tabindex="-1"></a><span class="co"># 8888 → JupyterLab</span></span>
<span id="cb12-412"><a href="#cb12-412" aria-hidden="true" tabindex="-1"></a><span class="co"># 8787 → httpgd / RStudio-like viewer</span></span>
<span id="cb12-413"><a href="#cb12-413" aria-hidden="true" tabindex="-1"></a><span class="kw">EXPOSE</span> 8888</span>
<span id="cb12-414"><a href="#cb12-414" aria-hidden="true" tabindex="-1"></a><span class="kw">EXPOSE</span> 8787</span>
<span id="cb12-415"><a href="#cb12-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-416"><a href="#cb12-416" aria-hidden="true" tabindex="-1"></a><span class="co"># Arranque por defecto: JupyterLab</span></span>
<span id="cb12-417"><a href="#cb12-417" aria-hidden="true" tabindex="-1"></a><span class="kw">CMD</span> [<span class="st">"jupyter"</span>, <span class="st">"lab"</span>, <span class="st">"--ip=0.0.0.0"</span>, <span class="st">"--port=8888"</span>, <span class="st">"--no-browser"</span>, <span class="st">"--allow-root"</span>, <span class="st">"--NotebookApp.token='geomatica2025'"</span>]</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="sec-arrancar_detener_contenedores" class="level2" data-number="D.7">
<h2 data-number="D.7" class="anchored" data-anchor-id="sec-arrancar_detener_contenedores"><span class="header-section-number">D.7</span> Arrancar y detener las imágenes</h2>
<section id="arrancar-las-imágenes" class="level3">
<h3 class="anchored" data-anchor-id="arrancar-las-imágenes">Arrancar las imágenes</h3>
<p>Los comandos <code>build</code> o <code>load</code> una vez se terminan satisfactoriamente, no necesitan volver a ejecutarse. El principal comando para subir el servicio de las imágenes instaladas se muestra a continuación.</p>
<p>Use este comando siempre antes de iniciar a trabajar con los contenedores instalados. <em>Esto activará los dos contenedores: uno para análisis geoespacial y otro para la base de datos.</em>:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> compose up <span class="at">-d</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Si detuvo los contenedores con <code>docker compose stop</code>, use este comando para <strong>reiniciarlos</strong>:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> compose start</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="detener-las-imágenes" class="level3">
<h3 class="anchored" data-anchor-id="detener-las-imágenes">Detener las imágenes</h3>
<p>Para <strong>apagar</strong> los contenedores sin borrar datos:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> compose stop</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Si necesita <strong>borrar todo</strong> (por ejemplo para reinstalar) (los datos de la DB se mantienen en el volumen):</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> compose down</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="verificar-logs-de-instalación" class="level2" data-number="D.8">
<h2 data-number="D.8" class="anchored" data-anchor-id="verificar-logs-de-instalación"><span class="header-section-number">D.8</span> Verificar logs de instalación</h2>
<p><strong>Verificación de Logs</strong>: Si desea ver el log de instalación de una imagen compilada, ejecute el siguiente comando, sin embargo la url de acceso a <strong>Jupyter Lab</strong> mostrada después de ejecutar este comando puede estar errónea. Para acceder a <strong>Jupyter Lab</strong> vea (<a href="81-uso_infraestructura_instalada.html#sec-acceder_jupyterlab" class="quarto-xref"><span>Sección C.8</span></a>)</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> logs contenedor_sig_unal</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="comandos-docker" class="level2" data-number="D.9">
<h2 data-number="D.9" class="anchored" data-anchor-id="comandos-docker"><span class="header-section-number">D.9</span> Comandos docker</h2>
<p>Use la siguiente tabla como referencia para gestionar sus contenedores desde la terminal de su sistema anfitrión (Windows/Mac/Linux).</p>
<table class="table">
<colgroup>
<col style="width: 20%">
<col style="width: 40%">
<col style="width: 40%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Acción</th>
<th style="text-align: left;">Comando</th>
<th style="text-align: left;">Propósito</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>Construcción Inicial</strong></td>
<td style="text-align: left;"><code>docker-compose up --build -d</code></td>
<td style="text-align: left;">Compila el Dockerfile y levanta los servicios (Solo una vez).</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Inicio Diario</strong></td>
<td style="text-align: left;"><code>docker-compose up -d</code></td>
<td style="text-align: left;">Inicia los servicios de forma instantánea si ya fueron construidos.</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Monitoreo de Procesos</strong></td>
<td style="text-align: left;"><code>docker logs -f entorno_unal_sig</code></td>
<td style="text-align: left;">Sigue los logs en vivo (ideal para ver pre-compilaciones).</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Ver logs recientes</strong></td>
<td style="text-align: left;"><code>docker logs --tail 20 entorno_unal_sig</code></td>
<td style="text-align: left;">Muestra las últimas 20 líneas (ideal para buscar el token).</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Apagado</strong></td>
<td style="text-align: left;"><code>docker-compose down</code></td>
<td style="text-align: left;">Detiene los servicios y libera recursos del sistema.</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Prueba de R (sf)</strong></td>
<td style="text-align: left;"><code>docker exec entorno_unal_sig R -e "library(sf); print('R-Spatial detectado')"</code></td>
<td style="text-align: left;">Confirmar que R reconoce los drivers geoespaciales del sistema.</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Prueba de Python</strong></td>
<td style="text-align: left;"><code>docker exec entorno_unal_sig python -c "import shapely; import geopandas; print('Python OK')"</code></td>
<td style="text-align: left;">Confirmar que el stack de Python (GeoPandas/Shapely) está instalado.</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Prueba de Julia</strong></td>
<td style="text-align: left;"><code>docker exec entorno_unal_sig julia -e "using LibGEOS; println('Julia OK')"</code></td>
<td style="text-align: left;">Confirmar que Julia tiene acceso a los binarios geoespaciales.</td>
</tr>
</tbody>
</table>
</section>
<section id="compilación-avanzada" class="level2" data-number="D.10">
<h2 data-number="D.10" class="anchored" data-anchor-id="compilación-avanzada"><span class="header-section-number">D.10</span> Compilación avanzada</h2>
<p>Para trabajar con entornos SIG, a menudo necesitamos reconstruir imágenes sin basura previa.</p>
<ul>
<li><strong>Compilación Limpia (Sin Cache) con Log:</strong> Para asegurar que Docker descargue todas las librerías desde cero y guarde un registro detallado de los errores: <code>docker build --no-cache -t mi_sig_env:v1 . --progress=plain &gt; build_details.log 2&gt;&amp;1</code></li>
<li><strong>Subir Imagen a Repositorio:</strong> <code>docker tag mi_sig_env:v1 usuario_dockerhub/mi_sig_env:v1</code> <code>docker push usuario_dockerhub/mi_sig_env:v1</code></li>
<li><strong>Cargar en VSCode:</strong> Una vez el contenedor esté corriendo, use la extensión <strong>Dev Containers</strong> -&gt; Botón verde inferior izquierdo -&gt; <em>Attach to Running Container</em>.</li>
</ul>
</section>
<section id="cambio-de-ruta-de-almacenamiento-windows" class="level2" data-number="D.11">
<h2 data-number="D.11" class="anchored" data-anchor-id="cambio-de-ruta-de-almacenamiento-windows"><span class="header-section-number">D.11</span> Cambio de ruta de almacenamiento (Windows)</h2>
<p>Si el disco <code>C:</code> se agota debido a las imágenes de Docker, siga estos pasos en <strong>Docker Desktop</strong>: 1. Vaya a <strong>Settings</strong> (engranaje). 2. <strong>Resources</strong> &gt; <strong>Advanced</strong>. 3. En <strong>Disk image location</strong>, cambie la ruta a un disco con mayor capacidad (ej. <code>D:\DockerImages</code>). 4. Presione <strong>Apply &amp; Restart</strong>.</p>
</section>
<section id="sec-optimizacion-memoria" class="level2" data-number="D.12">
<h2 data-number="D.12" class="anchored" data-anchor-id="sec-optimizacion-memoria"><span class="header-section-number">D.12</span> Optimización de memoria RAM y swap</h2>
<p>Cuando procesamos datos masivos (como imágenes Sentinel-2 o rásters globales), la RAM física de 16GB suele ser insuficiente. Para evitar que el sistema aborte los procesos con el error <strong>“Killed”</strong>, debemos configurar un “pulmón” de emergencia en dos niveles.</p>
<section id="el-pulmón-de-windows-memoria-virtual" class="level3">
<h3 class="anchored" data-anchor-id="el-pulmón-de-windows-memoria-virtual">1. El “pulmón” de Windows: memoria virtual</h3>
<p>Obligamos a Windows a usar el disco duro como si fuera RAM de reserva. Si tiene un disco sólido (SSD) secundario con mucho espacio libre (ej. Disco D:), es el lugar ideal para configurarlo.</p>
<ol type="1">
<li>En el buscador de Windows, escriba: <strong>“Ajustar la apariencia y rendimiento de Windows”</strong>.</li>
<li>Vaya a la pestaña <strong>Opciones avanzadas</strong> &gt; sección <strong>Memoria virtual</strong> &gt; clic en <strong>Cambiar</strong>.</li>
<li>Desmarque la opción “Administrar automáticamente el tamaño del archivo de paginación para todas las unidades”.</li>
<li>Seleccione la unidad de disco (C: o D:) y marque <strong>Tamaño personalizado</strong>.</li>
<li>Establezca los siguientes valores (recomendados para este curso):
<ul>
<li><strong>Tamaño inicial</strong>: <code>16384</code> MB (16 GB).</li>
<li><strong>Tamaño máximo</strong>: <code>32768</code> MB (32 GB).</li>
</ul></li>
<li>Haga clic en <strong>Establecer</strong>, luego en <strong>Aceptar</strong> y <strong>reinicie su computadora</strong> para aplicar los cambios.</li>
</ol>
</section>
<section id="el-túnel-de-docker-swap-de-wsl2" class="level3">
<h3 class="anchored" data-anchor-id="el-túnel-de-docker-swap-de-wsl2">2. El “túnel” de docker: swap de WSL2</h3>
<p>Docker Desktop corre sobre WSL2 (<em>Windows Subsystem for Linux</em>), el cual tiene su propio “presupuesto” limitado. Por defecto, este túnel es estrecho (máximo 4GB de Swap). Si no ampliamos esto, el contenedor nunca podrá aprovechar realmente el espacio que le asignamos a Windows.</p>
<p><strong>Cómo ampliar la tubería:</strong> 1. Presione <code>Win + R</code>, escriba <code>%UserProfile%</code> y presione Enter. 2. Busque el archivo <code>.wslconfig</code>. Si no existe, créelo con el Bloc de Notas. 3. Pegue el siguiente contenido:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode ini code-with-copy"><code class="sourceCode ini"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">[wsl2]</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="dt">memory</span><span class="ot">=</span><span class="st">12GB # RAM máxima que le permitimos usar a Linux/Docker</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="dt">swap</span><span class="ot">=</span><span class="st">16GB   # El nuevo tamaño de swap que verá el comando 'top' en la terminal</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol start="4" type="1">
<li><strong>Aplicar cambios</strong>: Guarde el archivo, abra una terminal (PowerShell) y escriba <code>wsl --shutdown</code>. Luego, inicie Docker Desktop nuevamente.</li>
</ol>
<hr>
</section>
</section>
<section id="higiene-y-limpieza-de-choque" class="level2" data-number="D.13">
<h2 data-number="D.13" class="anchored" data-anchor-id="higiene-y-limpieza-de-choque"><span class="header-section-number">D.13</span> Higiene y limpieza de choque</h2>
<p>Para garantizar que un renderizado de Quarto llegue al 100% sin colapsar el contenedor, aplique estas medidas de higiene:</p>
<ul>
<li><strong>Cierre “Vampiros”</strong>: Aplicaciones como Chrome, Edge, Teams y Slack consumen RAM de forma agresiva. Ciérrelas antes de procesos pesados.</li>
<li><strong>Limpieza de disco</strong>: Use el Liberador de espacio en disco (<code>cleanmgr</code>) para vaciar archivos de volcado de memoria.</li>
<li><strong>La “Escoba” en el Código</strong>: Use comandos de limpieza entre procesos de diferentes lenguajes:
<ul>
<li><strong>R</strong>: <code>rm(obj); gc(full = TRUE)</code></li>
<li><strong>Python</strong>: <code>del var; gc.collect()</code></li>
<li><strong>Julia</strong>: <code>GC.gc()</code></li>
</ul></li>
</ul>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Importante para Visualización
</div>
</div>
<div class="callout-body-container callout-body">
<p>En Julia y R, evite generar gráficos interactivos pesados dentro de bucles de procesamiento. La acumulación de objetos visuales en la memoria de VSCode es la causa número uno de colapsos en el contenedor.</p>
</div>
</div>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" data-line-spacing="2" role="list" style="display: none">
<div id="ref-docker2025" class="csl-entry" role="listitem">
Inc., D. (2025). <em>Docker Desktop Documentation</em>. <a href="https://docs.docker.com">https://docs.docker.com</a>
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copiado");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copiado");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./82-quarto.html" class="pagination-link" aria-label="Quarto: Orquestación y Configuración">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Quarto: Orquestación y Configuración</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./84-git_github.html" class="pagination-link" aria-label="Git y GitHub: Sincronización Local-Remota">
        <span class="nav-page-text"><span class="chapter-number">E</span>&nbsp; <span class="chapter-title">Git y GitHub: Sincronización Local-Remota</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>