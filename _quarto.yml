# CONFIGURACIÃ“N DEL PROYECTO
project:
  type: book                     # Tipo: libro (genera estructura de capÃ­tulos)
  output-dir: _site              # Carpeta de salida para archivos generados

lang: es  # <--- VITAL: Esto activa el espaÃ±ol para todo el proyecto (HTML y PDF)

# CONFIGURACIÃ“N DEL LIBRO
book:
  title: "ProgramaciÃ³n SIG: Python, R y Julia"
  author: "Alexys H. RodrÃ­guez-Avellaneda Ph.D."
  date: today                    # Fecha automÃ¡tica
  #language: es                   # Idioma: espaÃ±ol
  #language:
  #    chapter-label-single: "CapÃ­tulo"
  #    chapter-label-plural: "CapÃ­tulos"
  #    appendices-title: "ApÃ©ndices"
  #lang: es
  language: _language.yml  # <--- AquÃ­ apuntas al archivo

  # FUSIONAMOS TODO AQUÃ (Sin repetir la palabra 'language')
  #language:
  #  chapter-label-single: "CapÃ­tulo"
  #  chapter-label-plural: "CapÃ­tulos"
  #  appendices-title: "ApÃ©ndices"
  #  # AÃ±adimos estas para asegurar el HTML
  #  toc-title-document: "Tabla de contenidos"
  #  section-title-abstract: "Resumen"
  #  lof-title-document: "Lista de Figuras"
  #  lot-title-document: "Lista de Tablas"

  # ESTRUCTURA DEL LIBRO
  chapters:
    - index.qmd                  # Portada/Ã­ndice
    - 00-prefacio.qmd             # Prefacio (sin numeraciÃ³n)
    - part: "InstalaciÃ³n y Entornos"  # Primera parte
      chapters:                  # CapÃ­tulos de esta parte
        - 01-introduccion-entornos.qmd
        - 02-guia_instalacion_A_docker.qmd
        - 03-guia_instalacion_B_qgis.qmd
        - 04-guia_instalacion_C_ArcGIS.qmd
    - part: "Fundamentos"        # Segunda parte
      chapters:
        - 05-variables_tipos_de_datos.qmd
        - 06-estructuras_datos.qmd
        - 07-operaciones_cadenas.qmd
        #- 08-ciclos_condicionales.qmd
        #- 09-funciones_clases.qmd
        #- 10-trabajando_con_archivos.qmd
        #- 11-matrices_dataframes.qmd
        - 12-introduccion_python_r_julia.qmd
        - 13-estructuras_datos_geo.qmd
    - part: "PrÃ¡cticas"        # Tercera parte
      chapters:
        - 41-practica_1_benchmark_raster.qmd
    - part: "Presentaciones"        # Tercera parte
      chapters:
        - 61-presentacion_1_clase1.qmd
        - 62-presentacion_2_benchmark.qmd
        
  # APÃ‰NDICES (aparecen despuÃ©s de los capÃ­tulos)
  appendices:
    - 80-instalacion_herramientas.qmd
    - 81-uso_infraestructura_instalada.qmd  # InformaciÃ³n sobre contenedores y software instalado
    - 82-quarto.qmd              # InformaciÃ³n Adicional Quarto
    - 83-docker_desktop.qmd      # InformaciÃ³n sogre Docker Desktop
    - 84-git_github.qmd          # InformaiÃ³n sobre Git y GitHub
    - 85-vscode.qmd              # InformaciÃ³n sobre VSCode
    - 86-windows.qmd             # InformaciÃ³n sobre Windows
    - 87-linux_ubuntu.qmd        # InformaciÃ³n sobre Linux Ubuntu
    - 88-python.qmd              # Adicionales sobre Python
    - 89-r.qmd                   # InformaciÃ³n adicional sobre R
    - 90-julia.qmd               # InformaciÃ³n adicional sobre Julia
    - 91-qgis.qmd                #
    - 92-arcgispro.qmd           #
    - 93-postgresql.qmd
    - 98-errata.qmd              # Erratas
    - 99-referencias.qmd         # Referencias bibliogrÃ¡ficas
    # IMPORTANTE: Este archivo crea la secciÃ³n de referencias al final
    # Si se quita, las referencias aparecerÃ¡n sin tÃ­tulo en cada capÃ­tulo (HTML)
    # o no aparecerÃ¡n agrupadas al final (PDF)

crossref:  # <--- PERSONALIZACIÃ“N DE REFERENCIAS
  fig-title: "Figura"
  tbl-title: "Tabla"
  sec-prefix: "SecciÃ³n"
  eq-prefix: "EcuaciÃ³n"

# CONFIGURACIÃ“N DE BIBLIOGRAFÃA (GLOBAL)
bibliography: referencias.bib     # Archivo BibTeX con todas las referencias
csl: https://www.zotero.org/styles/apa  # Estilo de citaciÃ³n: APA
link-citations: true             # Enlaza citas con la bibliografÃ­a

# NIVEL GLOBAL (RECOMENDADO)
number-sections: true

# FORMATOS DE SALIDA
format:
  # FORMATO HTML (para web)
  html:
    theme: cosmo                 # Tema visual para HTML
    toc: true                    # Tabla de contenidos: activada
    toc-depth: 3                 # Profundidad del TOC: hasta nivel 3 (###)
    #number-sections: true        # NumeraciÃ³n automÃ¡tica de secciones
    number-depth: 2              # Numerar hasta nivel 2 (##)
    #lof: true  # <--- Fuerza la Lista de Figuras
    #lot: true  # <--- Fuerza la Lista de Tablas
    # reference-location: section # NO FUNCIONA con bibliografÃ­a global
    # Opciones: 'section' (final de secciÃ³n) o 'document' (final del documento)
    # Con bibliografÃ­a global, las referencias solo aparecen en el apÃ©ndice 93_references.qmd
    # TÃTULO EN ESPAÃ‘OL PARA HTML
    toc-title: "Tabla de Contenidos"
    lof-title: "Lista de Figuras"
    lot-title: "Lista de Tablas"

  # FORMATO PDF (para impresiÃ³n)
  pdf:
    documentclass: book          # Clase LaTeX: libro. Puedes usar "scrreport" (usa arabigo en la numeraciÃ³n inicial) o "book" (usa romanos en la paginaciÃ³n inicial)
    papersize: letter            # TamaÃ±o de papel: carta
    prefer-html: true      # <--- Lo que activamos para los mapas
    # MOTOR PDF MEJORADO - DEL OTRO YAML (xelatex puede manejar mejor caracteres especiales)
    # PRUEBA CON: lualatex (actual) o xelatex (alternativa)
    pdf-engine: lualatex         # o xelatex para probar si hay problemas
    cite-method: citeproc  # <-- AGREGA ESTO EXPLICITAMENTE

    # CONFIGURACIÃ“N DIRECTA PARA TÃTULOS EN ESPAÃ‘OL
    # Esto va AQUÃ, NO en include-in-header
    # lang: es-ES
    toc-title: "Tabla de Contenidos"
    lof-title: "Lista de Figuras"
    lot-title: "Lista de Tablas"

    geometry:                    # MÃ¡rgenes de la pÃ¡gina
      - top=2.5cm
      - bottom=2.5cm
      - left=2.5cm
      - right=2.5cm
    
    # CONFIGURACIÃ“N LaTeX (se inserta en el preÃ¡mbulo)
    include-in-header:
      text: |
        \usepackage{emptypage}   % Elimina nÃºmeros en pÃ¡ginas vacÃ­as
        % \usepackage[spanish]{babel}

        %PAQUETES APRA COLOREO DE TABLAS
        \usepackage{colortbl}

        % 2. CIRUGÃA DE EMOJIS PARA LUALATEX
        % Esto mapea los sÃ­mbolos que causan error a una fuente compatible
        \usepackage{fontspec}
        \usepackage{newunicodechar}
        
        % DefiniciÃ³n con la ruta exacta que encontrÃ³ fc-list
        \newfontfamily{\symbolsfont}{Symbola}[
          Path=/usr/share/fonts/truetype/ancient-scripts/,
          Extension=.ttf,
          UprightFont=*_hint,
          ErrorIfNotFound=false
        ]
        
        % Mapeo de caracteres detectados en tu error:
        \newunicodechar{ðŸ}{{\symbolsfont ðŸ}}
        \newunicodechar{âœ…}{{\symbolsfont âœ…}}
        \newunicodechar{âŒ}{{\symbolsfont âŒ}}
        \newunicodechar{âš¡}{{\symbolsfont âš¡}}
        \newunicodechar{ðŸŸ£}{{\symbolsfont ðŸŸ£}}
        \newunicodechar{ðŸŸ¤}{{\symbolsfont ðŸŸ¤}}
        \newunicodechar{ðŸ}{{\symbolsfont ðŸ}}
        \newunicodechar{ðŸŒŸ}{{\symbolsfont ðŸŒŸ}}
        \newunicodechar{â†”}{{\symbolsfont â†”}}

        % PAQUETES PARA AJUSTAR CÃ“DIGO
        \usepackage{fvextra}  % Mejoras para listings
        \usepackage{xcolor}
        \usepackage{listings}
        
        % CONFIGURACIÃ“N GENERAL PARA TODOS LOS BLOQUES DE CÃ“DIGO
        \lstset{
          basicstyle=\ttfamily\footnotesize,
          breaklines=true,
          breakatwhitespace=false,  % Permite dividir EN CUALQUIER PUNTO
          breakindent=0pt,
          prebreak=\raisebox{0ex}[0ex][0ex]{\ensuremath{\hookrightarrow}},
          postbreak=\raisebox{0ex}[0ex][0ex]{\ensuremath{\hookleftarrow}\space},
          columns=fullflexible,
          showstringspaces=false,
          frame=single,
          framerule=0.5pt,
          framesep=5pt,
          % CARACTERES ESPECIALES QUE PUEDEN DIVIDIRSE
          literate={\\}{{\textbackslash}}1
                  {~}{{\textasciitilde}}1
                  {|}{{\textbar}}1
                  {/}{{/}}1
                  {=}{{=}}1
                  {-}{{-}}1,
        }

        % CONFIGURACIÃ“N ESPECÃFICA PARA BASH/SHELL
        \lstdefinestyle{bash}{
          language=bash,
          basicstyle=\ttfamily\footnotesize,
          breaklines=true,
          breakatwhitespace=false,
          morekeywords={sudo, apt-get, curl, docker},
          keywordstyle=\color{blue},
          commentstyle=\color{gray},
          stringstyle=\color{red},
          showstringspaces=false,
        }
        
        % APLICAR ESTILO BASH AUTOMÃTICAMENTE
        \lstnewenvironment{bashcode}{\lstset{style=bash}}{}
        
        % SOBRESCRIBIR ENTORNOS DE QUARTO
        \usepackage{fancyvrb}
        \fvset{
          fontsize=\footnotesize,
          frame=single,
          framesep=3mm,
          breaklines=true,
          breakanywhere=true,  % CLAVE: permite dividir en cualquier carÃ¡cter
          baselinestretch=0.8,
        }
        
        % PARA LOS BLOQUES Shaded DE QUARTO
        \RecustomVerbatimEnvironment{Highlighting}{Verbatim}{
          breaklines=true,
          breakanywhere=true,
          commandchars=\\\{\},
          fontsize=\footnotesize,
        }

        % NOTA: NO usar cite-method: biblatex aquÃ­ porque:
        % 1. Causa conflicto con csl: apa
        % 2. Genera error "Option clash for package biblatex"
        % 3. Pandoc maneja automÃ¡ticamente las citas con el CSL APA
    
    # reference-location: section  # NO tiene efecto con bibliografÃ­a global
    # Las referencias aparecen solo donde estÃ¡ 93_references.qmd
    
    linestretch: 1.25            # Espaciado entre lÃ­neas
    toc: true                    # Tabla de contenidos en PDF
    toc-depth: 3                 # Profundidad del TOC en PDF
    lof: true  # <--- Fuerza la Lista de Figuras
    lot: true  # <--- Fuerza la Lista de Tablas    
    #number-sections: true        # Numerar secciones en PDF
    colorlinks: true             # Enlaces en color (no cajas)
    fig-cap-location: bottom     # UbicaciÃ³n de leyendas de figuras: abajo

# RESUMEN DEL COMPORTAMIENTO:
# 1. Todas las citas [@autor] en cualquier archivo se recopilan automÃ¡ticamente
# 2. Se muestran ÃšNICAMENTE en 93_references.qmd (apÃ©ndice final)
# 3. HTML: Referencias al final del libro, no por capÃ­tulo
# 4. PDF: Referencias como apÃ©ndice final con tÃ­tulo
# 5. Estilo APA aplicado automÃ¡ticamente
# 6. Sin conflictos LaTeX/CSL

# PARA REFERENCIAS POR CAPÃTULO (NO esta configuraciÃ³n):
# 1. Quitar bibliography, csl, link-citations del YAML
# 2. Agregar esos metadatos en cada archivo .qmd individual
# 3. Agregar "::: {#refs} :::" al final de cada capÃ­tulo