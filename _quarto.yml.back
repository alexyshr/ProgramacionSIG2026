# CONFIGURACI√ìN DEL PROYECTO
project:
  type: book                     # Tipo: libro (genera estructura de cap√≠tulos)
  output-dir: _site              # Carpeta de salida para archivos generados

# CONFIGURACI√ìN DEL LIBRO
book:
  title: "Programaci√≥n SIG: Python, R y Julia"
  author: "Alexys H. Rodr√≠guez-Avellaneda Ph.D."
  date: today                    # Fecha autom√°tica
  language: es                   # Idioma: espa√±ol
  
  # ESTRUCTURA DEL LIBRO
  chapters:
    - index.qmd                  # Portada/√≠ndice
    - 00-prefacio.qmd             # Prefacio (sin numeraci√≥n)
    - part: "Instalaci√≥n y Entornos"  # Primera parte
      chapters:                  # Cap√≠tulos de esta parte
        - 01-introduccion-entornos.qmd
        - 02-guia_instalacion_A_docker.qmd
        - 03-guia_instalacion_B_qgis.qmd
        - 04-guia_instalacion_C_ArcGIS.qmd
    - part: "Fundamentos"        # Segunda parte
      chapters:
        - 05-introduccion_python_r_julia.qmd
        - 06-estructuras_datos_geo.qmd
    - part: "Pr√°cticas"        # Tercera parte
      chapters:
        - 41-practica_1_benchmark_raster.qmd
    - part: "Presentaciones"        # Tercera parte
      chapters:
        - 61-presentacion_1_varios.qmd
        - 62-presentacion_2_benchmark.qmd
        
  # AP√âNDICES (aparecen despu√©s de los cap√≠tulos)
  appendices:
    - 81-infraestructura_instalada.qmd  # Informaci√≥n sobre contenedores y software instalado
    - 82-quarto.qmd              # A. Informaci√≥n Adicional Quarto
    - 83-docker_desktop.qmd      # B. Informaci√≥n sogre Docker Desktop
    - 84-git_github.qmd          # C. Informai√≥n sobre Git y GitHub
    - 85-vscode.qmd              # D. Informaci√≥n sobre VSCode
    - 86-windows.qmd             # E. Informaci√≥n sobre Windows
    - 87-linux_ubuntu.qmd        # F. Informaci√≥n sobre Linux Ubuntu
    - 88-python.qmd              # G. Adicionales sobre Python
    - 89-r.qmd                   # H. Informaci√≥n adicional sobre R
    - 90-julia.qmd               # I. Informaci√≥n adicional sobre Julia
    - 98-errata.qmd              # J. Erratas
    - 99-referencias.qmd         # K. Referencias bibliogr√°ficas
    # IMPORTANTE: Este archivo crea la secci√≥n de referencias al final
    # Si se quita, las referencias aparecer√°n sin t√≠tulo en cada cap√≠tulo (HTML)
    # o no aparecer√°n agrupadas al final (PDF)

# CONFIGURACI√ìN DE BIBLIOGRAF√çA (GLOBAL)
bibliography: referencias.bib     # Archivo BibTeX con todas las referencias
csl: https://www.zotero.org/styles/apa  # Estilo de citaci√≥n: APA
link-citations: true             # Enlaza citas con la bibliograf√≠a

# NIVEL GLOBAL (RECOMENDADO)
number-sections: true

# FORMATOS DE SALIDA
format:
  # FORMATO HTML (para web)
  html:
    theme: cosmo                 # Tema visual para HTML
    toc: true                    # Tabla de contenidos: activada
    toc-depth: 3                 # Profundidad del TOC: hasta nivel 3 (###)
    #number-sections: true        # Numeraci√≥n autom√°tica de secciones
    number-depth: 2              # Numerar hasta nivel 2 (##)
    # reference-location: section # NO FUNCIONA con bibliograf√≠a global
    # Opciones: 'section' (final de secci√≥n) o 'document' (final del documento)
    # Con bibliograf√≠a global, las referencias solo aparecen en el ap√©ndice 93_references.qmd
    # T√çTULO EN ESPA√ëOL PARA HTML
    toc-title: "Tabla de Contenidos"

  # FORMATO PDF (para impresi√≥n)
  pdf:
    documentclass: book          # Clase LaTeX: libro. Puedes usar "scrreport" (usa arabigo en la numeraci√≥n inicial) o "book" (usa romanos en la paginaci√≥n inicial)
    papersize: letter            # Tama√±o de papel: carta
    
    # MOTOR PDF MEJORADO - DEL OTRO YAML (xelatex puede manejar mejor caracteres especiales)
    # PRUEBA CON: lualatex (actual) o xelatex (alternativa)
    pdf-engine: lualatex         # o xelatex para probar si hay problemas
    cite-method: citeproc  # <-- AGREGA ESTO EXPLICITAMENTE

    # CONFIGURACI√ìN DIRECTA PARA T√çTULOS EN ESPA√ëOL
    # Esto va AQU√ç, NO en include-in-header
    # lang: es-ES
    toc-title: "Tabla de Contenidos"
    lof-title: "Lista de Figuras"
    lot-title: "Lista de Tablas"

    geometry:                    # M√°rgenes de la p√°gina
      - top=2.5cm
      - bottom=2.5cm
      - left=2.5cm
      - right=2.5cm
    
    # CONFIGURACI√ìN LaTeX (se inserta en el pre√°mbulo)
    include-in-header:
      text: |
        \usepackage{emptypage}   % Elimina n√∫meros en p√°ginas vac√≠as
        % \usepackage[spanish]{babel}

        %PAQUETES APRA COLOREO DE TABLAS
        \usepackage{colortbl}

        % 2. CIRUG√çA DE EMOJIS PARA LUALATEX
        % Esto mapea los s√≠mbolos que causan error a una fuente compatible
        \usepackage{fontspec}
        \usepackage{newunicodechar}
        
        % Definici√≥n con la ruta exacta que encontr√≥ fc-list
        \newfontfamily{\symbolsfont}{Symbola}[
          Path=/usr/share/fonts/truetype/ancient-scripts/,
          Extension=.ttf,
          UprightFont=*_hint,
          ErrorIfNotFound=false
        ]
        
        % Mapeo de caracteres detectados en tu error:
        \newunicodechar{üêç}{{\symbolsfont üêç}}
        \newunicodechar{‚úÖ}{{\symbolsfont ‚úÖ}}
        \newunicodechar{‚ùå}{{\symbolsfont ‚ùå}}
        \newunicodechar{‚ö°}{{\symbolsfont ‚ö°}}
        \newunicodechar{üü£}{{\symbolsfont üü£}}
        \newunicodechar{üü§}{{\symbolsfont üü§}}
        \newunicodechar{üèÅ}{{\symbolsfont üèÅ}}
        \newunicodechar{üåü}{{\symbolsfont üåü}}
        \newunicodechar{‚Üî}{{\symbolsfont ‚Üî}}

        % PAQUETES PARA AJUSTAR C√ìDIGO
        \usepackage{fvextra}  % Mejoras para listings
        \usepackage{xcolor}
        \usepackage{listings}
        
        % CONFIGURACI√ìN GENERAL PARA TODOS LOS BLOQUES DE C√ìDIGO
        \lstset{
          basicstyle=\ttfamily\footnotesize,
          breaklines=true,
          breakatwhitespace=false,  % Permite dividir EN CUALQUIER PUNTO
          breakindent=0pt,
          prebreak=\raisebox{0ex}[0ex][0ex]{\ensuremath{\hookrightarrow}},
          postbreak=\raisebox{0ex}[0ex][0ex]{\ensuremath{\hookleftarrow}\space},
          columns=fullflexible,
          showstringspaces=false,
          frame=single,
          framerule=0.5pt,
          framesep=5pt,
          % CARACTERES ESPECIALES QUE PUEDEN DIVIDIRSE
          literate={\\}{{\textbackslash}}1
                  {~}{{\textasciitilde}}1
                  {|}{{\textbar}}1
                  {/}{{/}}1
                  {=}{{=}}1
                  {-}{{-}}1,
        }

        % CONFIGURACI√ìN ESPEC√çFICA PARA BASH/SHELL
        \lstdefinestyle{bash}{
          language=bash,
          basicstyle=\ttfamily\footnotesize,
          breaklines=true,
          breakatwhitespace=false,
          morekeywords={sudo, apt-get, curl, docker},
          keywordstyle=\color{blue},
          commentstyle=\color{gray},
          stringstyle=\color{red},
          showstringspaces=false,
        }
        
        % APLICAR ESTILO BASH AUTOM√ÅTICAMENTE
        \lstnewenvironment{bashcode}{\lstset{style=bash}}{}
        
        % SOBRESCRIBIR ENTORNOS DE QUARTO
        \usepackage{fancyvrb}
        \fvset{
          fontsize=\footnotesize,
          frame=single,
          framesep=3mm,
          breaklines=true,
          breakanywhere=true,  % CLAVE: permite dividir en cualquier car√°cter
          baselinestretch=0.8,
        }
        
        % PARA LOS BLOQUES Shaded DE QUARTO
        \RecustomVerbatimEnvironment{Highlighting}{Verbatim}{
          breaklines=true,
          breakanywhere=true,
          commandchars=\\\{\},
          fontsize=\footnotesize,
        }

        % NOTA: NO usar cite-method: biblatex aqu√≠ porque:
        % 1. Causa conflicto con csl: apa
        % 2. Genera error "Option clash for package biblatex"
        % 3. Pandoc maneja autom√°ticamente las citas con el CSL APA
    
    # reference-location: section  # NO tiene efecto con bibliograf√≠a global
    # Las referencias aparecen solo donde est√° 93_references.qmd
    
    linestretch: 1.25            # Espaciado entre l√≠neas
    toc: true                    # Tabla de contenidos en PDF
    toc-depth: 3                 # Profundidad del TOC en PDF
    #number-sections: true        # Numerar secciones en PDF
    colorlinks: true             # Enlaces en color (no cajas)
    fig-cap-location: bottom     # Ubicaci√≥n de leyendas de figuras: abajo

# RESUMEN DEL COMPORTAMIENTO:
# 1. Todas las citas [@autor] en cualquier archivo se recopilan autom√°ticamente
# 2. Se muestran √öNICAMENTE en 93_references.qmd (ap√©ndice final)
# 3. HTML: Referencias al final del libro, no por cap√≠tulo
# 4. PDF: Referencias como ap√©ndice final con t√≠tulo
# 5. Estilo APA aplicado autom√°ticamente
# 6. Sin conflictos LaTeX/CSL

# PARA REFERENCIAS POR CAP√çTULO (NO esta configuraci√≥n):
# 1. Quitar bibliography, csl, link-citations del YAML
# 2. Agregar esos metadatos en cada archivo .qmd individual
# 3. Agregar "::: {#refs} :::" al final de cada cap√≠tulo